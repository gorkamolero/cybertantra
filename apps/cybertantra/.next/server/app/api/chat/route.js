(()=>{var a={};a.id=276,a.ids=[276],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2785:(a,b,c)=>{"use strict";let d;c.r(b),c.d(b,{handler:()=>d5,patchFetch:()=>d4,routeModule:()=>d0,serverHooks:()=>d3,workAsyncStorage:()=>d1,workUnitAsyncStorage:()=>d2});var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K={};c.r(K),c.d(K,{POST:()=>d_});var L=c(7888),M=c(9164),N=c(6723),O=c(8267),P=c(8573),Q=c(261),R=c(1759),S=c(6337),T=c(8699),U=c(7528),V=c(9542),W=c(9324),X=c(4758),Y=c(451),Z=c(6439),$=c(2465),_="vercel.ai.error",aa=Symbol.for(_),ab=class a extends Error{constructor({name:a,message:b,cause:c}){super(b),this[e]=!0,this.name=a,this.cause=c}static isInstance(b){return a.hasMarker(b,_)}static hasMarker(a,b){let c=Symbol.for(b);return null!=a&&"object"==typeof a&&c in a&&"boolean"==typeof a[c]&&!0===a[c]}};e=aa;var ac=ab,ad="AI_APICallError",ae=`vercel.ai.error.${ad}`,af=Symbol.for(ae),ag=class extends ac{constructor({message:a,url:b,requestBodyValues:c,statusCode:d,responseHeaders:e,responseBody:g,cause:h,isRetryable:i=null!=d&&(408===d||409===d||429===d||d>=500),data:j}){super({name:ad,message:a,cause:h}),this[f]=!0,this.url=b,this.requestBodyValues=c,this.statusCode=d,this.responseHeaders=e,this.responseBody=g,this.isRetryable=i,this.data=j}static isInstance(a){return ac.hasMarker(a,ae)}};f=af;var ah="AI_EmptyResponseBodyError",ai=`vercel.ai.error.${ah}`,aj=Symbol.for(ai),ak=class extends ac{constructor({message:a="Empty response body"}={}){super({name:ah,message:a}),this[g]=!0}static isInstance(a){return ac.hasMarker(a,ai)}};function al(a){return null==a?"unknown error":"string"==typeof a?a:a instanceof Error?a.message:JSON.stringify(a)}g=aj;var am="AI_InvalidArgumentError",an=`vercel.ai.error.${am}`,ao=Symbol.for(an),ap=class extends ac{constructor({message:a,cause:b,argument:c}){super({name:am,message:a,cause:b}),this[h]=!0,this.argument=c}static isInstance(a){return ac.hasMarker(a,an)}};h=ao;var aq="AI_InvalidPromptError",ar=`vercel.ai.error.${aq}`,as=Symbol.for(ar),at=class extends ac{constructor({prompt:a,message:b,cause:c}){super({name:aq,message:`Invalid prompt: ${b}`,cause:c}),this[i]=!0,this.prompt=a}static isInstance(a){return ac.hasMarker(a,ar)}};i=as,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var au="AI_JSONParseError",av=`vercel.ai.error.${au}`,aw=Symbol.for(av),ax=class extends ac{constructor({text:a,cause:b}){super({name:au,message:`JSON parsing failed: Text: ${a}.
Error message: ${al(b)}`,cause:b}),this[j]=!0,this.text=a}static isInstance(a){return ac.hasMarker(a,av)}};j=aw,Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var ay="AI_NoSuchModelError",az=`vercel.ai.error.${ay}`,aA=Symbol.for(az),aB=class extends ac{constructor({errorName:a=ay,modelId:b,modelType:c,message:d=`No such ${c}: ${b}`}){super({name:a,message:d}),this[k]=!0,this.modelId=b,this.modelType=c}static isInstance(a){return ac.hasMarker(a,az)}};k=aA,Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var aC="AI_TypeValidationError",aD=`vercel.ai.error.${aC}`,aE=Symbol.for(aD),aF=class a extends ac{constructor({value:a,cause:b}){super({name:aC,message:`Type validation failed: Value: ${JSON.stringify(a)}.
Error message: ${al(b)}`,cause:b}),this[l]=!0,this.value=a}static isInstance(a){return ac.hasMarker(a,aD)}static wrap({value:b,cause:c}){return a.isInstance(c)&&c.value===b?c:new a({value:b,cause:c})}};l=aE;Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");class aG extends Error{constructor(a,b){super(a),this.name="ParseError",this.type=b.type,this.field=b.field,this.value=b.value,this.line=b.line}}function aH(a){}class aI extends TransformStream{constructor({onError:a,onRetry:b,onComment:c}={}){let d;super({start(e){d=function(a){if("function"==typeof a)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:b=aH,onError:c=aH,onRetry:d=aH,onComment:e}=a,f="",g=!0,h,i="",j="";function k(a){if(""===a)return void(i.length>0&&b({id:h,event:j||void 0,data:i.endsWith(`
`)?i.slice(0,-1):i}),h=void 0,i="",j="");if(a.startsWith(":")){e&&e(a.slice(a.startsWith(": ")?2:1));return}let c=a.indexOf(":");if(-1!==c){let b=a.slice(0,c),d=" "===a[c+1]?2:1;l(b,a.slice(c+d),a);return}l(a,"",a)}function l(a,b,e){switch(a){case"event":j=b;break;case"data":i=`${i}${b}
`;break;case"id":h=b.includes("\0")?void 0:b;break;case"retry":/^\d+$/.test(b)?d(parseInt(b,10)):c(new aG(`Invalid \`retry\` value: "${b}"`,{type:"invalid-retry",value:b,line:e}));break;default:c(new aG(`Unknown field "${a.length>20?`${a.slice(0,20)}\u2026`:a}"`,{type:"unknown-field",field:a,value:b,line:e}))}}return{feed:function(a){let b=g?a.replace(/^\xEF\xBB\xBF/,""):a,[c,d]=function(a){let b=[],c="",d=0;for(;d<a.length;){let e=a.indexOf("\r",d),f=a.indexOf(`
`,d),g=-1;if(-1!==e&&-1!==f?g=Math.min(e,f):-1!==e?g=e:-1!==f&&(g=f),-1===g){c=a.slice(d);break}{let c=a.slice(d,g);b.push(c),"\r"===a[(d=g+1)-1]&&a[d]===`
`&&d++}}return[b,c]}(`${f}${b}`);for(let a of c)k(a);f=d,g=!1},reset:function(a={}){f&&a.consume&&k(f),g=!0,h=void 0,i="",j="",f=""}}}({onEvent:a=>{e.enqueue(a)},onError(b){"terminate"===a?e.error(b):"function"==typeof a&&a(b)},onRetry:b,onComment:c})},transform(a){d.feed(a)}})}}var aJ=c(9268),aK=c(2503);class aL{constructor(a){this.counter=0,this.metadataRegistry=a?.metadata??aJ.fd,this.target=a?.target??"draft-2020-12",this.unrepresentable=a?.unrepresentable??"throw",this.override=a?.override??(()=>{}),this.io=a?.io??"output",this.seen=new Map}process(a,b={path:[],schemaPath:[]}){var c;let d=a._zod.def,e=this.seen.get(a);if(e)return e.count++,b.schemaPath.includes(a)&&(e.cycle=b.path),e.schema;let f={schema:{},count:1,cycle:void 0,path:b.path};this.seen.set(a,f);let g=a._zod.toJSONSchema?.();if(g)f.schema=g;else{let c={...b,schemaPath:[...b.schemaPath,a],path:b.path},e=a._zod.parent;if(e)f.ref=e,this.process(e,c),this.seen.get(e).isParent=!0;else{let b=f.schema;switch(d.type){case"string":{b.type="string";let{minimum:c,maximum:d,format:e,patterns:g,contentEncoding:h}=a._zod.bag;if("number"==typeof c&&(b.minLength=c),"number"==typeof d&&(b.maxLength=d),e&&(b.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[e]??e,""===b.format&&delete b.format),h&&(b.contentEncoding=h),g&&g.size>0){let a=[...g];1===a.length?b.pattern=a[0].source:a.length>1&&(f.schema.allOf=[...a.map(a=>({..."draft-7"===this.target?{type:"string"}:{},pattern:a.source}))])}break}case"number":{let{minimum:c,maximum:d,format:e,multipleOf:f,exclusiveMaximum:g,exclusiveMinimum:h}=a._zod.bag;"string"==typeof e&&e.includes("int")?b.type="integer":b.type="number","number"==typeof h&&(b.exclusiveMinimum=h),"number"==typeof c&&(b.minimum=c,"number"==typeof h&&(h>=c?delete b.minimum:delete b.exclusiveMinimum)),"number"==typeof g&&(b.exclusiveMaximum=g),"number"==typeof d&&(b.maximum=d,"number"==typeof g&&(g<=d?delete b.maximum:delete b.exclusiveMaximum)),"number"==typeof f&&(b.multipleOf=f);break}case"boolean":case"success":b.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"null":b.type="null";break;case"any":case"unknown":break;case"undefined":if("throw"===this.unrepresentable)throw Error("Undefined cannot be represented in JSON Schema");break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"never":b.not={};break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:e,maximum:f}=a._zod.bag;"number"==typeof e&&(b.minItems=e),"number"==typeof f&&(b.maxItems=f),b.type="array",b.items=this.process(d.element,{...c,path:[...c.path,"items"]});break}case"object":{b.type="object",b.properties={};let a=d.shape;for(let d in a)b.properties[d]=this.process(a[d],{...c,path:[...c.path,"properties",d]});let e=new Set([...new Set(Object.keys(a))].filter(a=>{let b=d.shape[a]._zod;return"input"===this.io?void 0===b.optin:void 0===b.optout}));e.size>0&&(b.required=Array.from(e)),d.catchall?._zod.def.type==="never"?b.additionalProperties=!1:d.catchall?d.catchall&&(b.additionalProperties=this.process(d.catchall,{...c,path:[...c.path,"additionalProperties"]})):"output"===this.io&&(b.additionalProperties=!1);break}case"union":b.anyOf=d.options.map((a,b)=>this.process(a,{...c,path:[...c.path,"anyOf",b]}));break;case"intersection":{let a=this.process(d.left,{...c,path:[...c.path,"allOf",0]}),e=this.process(d.right,{...c,path:[...c.path,"allOf",1]}),f=a=>"allOf"in a&&1===Object.keys(a).length;b.allOf=[...f(a)?a.allOf:[a],...f(e)?e.allOf:[e]];break}case"tuple":{b.type="array";let e=d.items.map((a,b)=>this.process(a,{...c,path:[...c.path,"prefixItems",b]}));if("draft-2020-12"===this.target?b.prefixItems=e:b.items=e,d.rest){let a=this.process(d.rest,{...c,path:[...c.path,"items"]});"draft-2020-12"===this.target?b.items=a:b.additionalItems=a}d.rest&&(b.items=this.process(d.rest,{...c,path:[...c.path,"items"]}));let{minimum:f,maximum:g}=a._zod.bag;"number"==typeof f&&(b.minItems=f),"number"==typeof g&&(b.maxItems=g);break}case"record":b.type="object",b.propertyNames=this.process(d.keyType,{...c,path:[...c.path,"propertyNames"]}),b.additionalProperties=this.process(d.valueType,{...c,path:[...c.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let a=(0,aK.w5)(d.entries);a.every(a=>"number"==typeof a)&&(b.type="number"),a.every(a=>"string"==typeof a)&&(b.type="string"),b.enum=a;break}case"literal":{let a=[];for(let b of d.values)if(void 0===b){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof b)if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else a.push(Number(b));else a.push(b);if(0===a.length);else if(1===a.length){let c=a[0];b.type=null===c?"null":typeof c,b.const=c}else a.every(a=>"number"==typeof a)&&(b.type="number"),a.every(a=>"string"==typeof a)&&(b.type="string"),a.every(a=>"boolean"==typeof a)&&(b.type="string"),a.every(a=>null===a)&&(b.type="null"),b.enum=a;break}case"file":{let c={type:"string",format:"binary",contentEncoding:"binary"},{minimum:d,maximum:e,mime:f}=a._zod.bag;void 0!==d&&(c.minLength=d),void 0!==e&&(c.maxLength=e),f?1===f.length?(c.contentMediaType=f[0],Object.assign(b,c)):b.anyOf=f.map(a=>({...c,contentMediaType:a})):Object.assign(b,c);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":b.anyOf=[this.process(d.innerType,c),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(d.innerType,c),f.ref=d.innerType;break;case"default":this.process(d.innerType,c),f.ref=d.innerType,b.default=JSON.parse(JSON.stringify(d.defaultValue));break;case"prefault":this.process(d.innerType,c),f.ref=d.innerType,"input"===this.io&&(b._prefault=JSON.parse(JSON.stringify(d.defaultValue)));break;case"catch":{let a;this.process(d.innerType,c),f.ref=d.innerType;try{a=d.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}b.default=a;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let c=a._zod.pattern;if(!c)throw Error("Pattern not found in template literal");b.type="string",b.pattern=c.source;break}case"pipe":{let a="input"===this.io?"transform"===d.in._zod.def.type?d.out:d.in:d.out;this.process(a,c),f.ref=a;break}case"readonly":this.process(d.innerType,c),f.ref=d.innerType,b.readOnly=!0;break;case"lazy":{let b=a._zod.innerType;this.process(b,c),f.ref=b;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}}let h=this.metadataRegistry.get(a);return h&&Object.assign(f.schema,h),"input"===this.io&&function a(b,c){let d=c??{seen:new Set};if(d.seen.has(b))return!1;d.seen.add(b);let e=b._zod.def;switch(e.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return a(e.element,d);case"object":for(let b in e.shape)if(a(e.shape[b],d))return!0;return!1;case"union":for(let b of e.options)if(a(b,d))return!0;return!1;case"intersection":return a(e.left,d)||a(e.right,d);case"tuple":for(let b of e.items)if(a(b,d))return!0;if(e.rest&&a(e.rest,d))return!0;return!1;case"record":case"map":return a(e.keyType,d)||a(e.valueType,d);case"set":return a(e.valueType,d);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return a(e.innerType,d);case"lazy":return a(e.getter(),d);case"transform":return!0;case"pipe":return a(e.in,d)||a(e.out,d)}throw Error(`Unknown schema type: ${e.type}`)}(a)&&(delete f.schema.examples,delete f.schema.default),"input"===this.io&&f.schema._prefault&&((c=f.schema).default??(c.default=f.schema._prefault)),delete f.schema._prefault,this.seen.get(a).schema}emit(a,b){let c={cycles:b?.cycles??"ref",reused:b?.reused??"inline",external:b?.external??void 0},d=this.seen.get(a);if(!d)throw Error("Unprocessed schema. This is a bug in Zod.");let e=a=>{let b="draft-2020-12"===this.target?"$defs":"definitions";if(c.external){let d=c.external.registry.get(a[0])?.id,e=c.external.uri??(a=>a);if(d)return{ref:e(d)};let f=a[1].defId??a[1].schema.id??`schema${this.counter++}`;return a[1].defId=f,{defId:f,ref:`${e("__shared")}#/${b}/${f}`}}if(a[1]===d)return{ref:"#"};let e=`#/${b}/`,f=a[1].schema.id??`__schema${this.counter++}`;return{defId:f,ref:e+f}},f=a=>{if(a[1].schema.$ref)return;let b=a[1],{ref:c,defId:d}=e(a);b.def={...b.schema},d&&(b.defId=d);let f=b.schema;for(let a in f)delete f[a];f.$ref=c};if("throw"===c.cycles)for(let a of this.seen.entries()){let b=a[1];if(b.cycle)throw Error(`Cycle detected: #/${b.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let b of this.seen.entries()){let d=b[1];if(a===b[0]){f(b);continue}if(c.external){let d=c.external.registry.get(b[0])?.id;if(a!==b[0]&&d){f(b);continue}}if(this.metadataRegistry.get(b[0])?.id||d.cycle||d.count>1&&"ref"===c.reused){f(b);continue}}let g=(a,b)=>{let c=this.seen.get(a),d=c.def??c.schema,e={...d};if(null===c.ref)return;let f=c.ref;if(c.ref=null,f){g(f,b);let a=this.seen.get(f).schema;a.$ref&&"draft-7"===b.target?(d.allOf=d.allOf??[],d.allOf.push(a)):(Object.assign(d,a),Object.assign(d,e))}c.isParent||this.override({zodSchema:a,jsonSchema:d,path:c.path??[]})};for(let a of[...this.seen.entries()].reverse())g(a[0],{target:this.target});let h={};if("draft-2020-12"===this.target?h.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?h.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),c.external?.uri){let b=c.external.registry.get(a)?.id;if(!b)throw Error("Schema is missing an `id` property");h.$id=c.external.uri(b)}Object.assign(h,d.def);let i=c.external?.defs??{};for(let a of this.seen.entries()){let b=a[1];b.def&&b.defId&&(i[b.defId]=b.def)}c.external||Object.keys(i).length>0&&("draft-2020-12"===this.target?h.$defs=i:h.definitions=i);try{return JSON.parse(JSON.stringify(h))}catch(a){throw Error("Error converting schema to JSON.")}}}var aM=c(7431);let aN=Symbol("Let zodToJsonSchema decide on which parser to use"),aO={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"};m||(m={});let aP=(a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")};function aQ(a){if("openAi"!==a.target)return{};let b=[...a.basePath,a.definitionPath,a.openAiAnyTypeName];return a.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===a.$refStrategy?aP(b,a.currentPath):b.join("/")}}function aR(a,b,c,d){d?.errorMessages&&c&&(a.errorMessage={...a.errorMessage,[b]:c})}function aS(a,b,c,d,e){a[b]=c,aR(a,b,d,e)}function aT(a,b){return a2(a.type._def,b)}let aU={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===d&&(d=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),d),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function aV(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":aS(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b);break;case"max":aS(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"email":switch(b.emailStrategy){case"format:email":aY(c,"email",d.message,b);break;case"format:idn-email":aY(c,"idn-email",d.message,b);break;case"pattern:zod":aZ(c,aU.email,d.message,b)}break;case"url":aY(c,"uri",d.message,b);break;case"uuid":aY(c,"uuid",d.message,b);break;case"regex":aZ(c,d.regex,d.message,b);break;case"cuid":aZ(c,aU.cuid,d.message,b);break;case"cuid2":aZ(c,aU.cuid2,d.message,b);break;case"startsWith":aZ(c,RegExp(`^${aW(d.value,b)}`),d.message,b);break;case"endsWith":aZ(c,RegExp(`${aW(d.value,b)}$`),d.message,b);break;case"datetime":aY(c,"date-time",d.message,b);break;case"date":aY(c,"date",d.message,b);break;case"time":aY(c,"time",d.message,b);break;case"duration":aY(c,"duration",d.message,b);break;case"length":aS(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b),aS(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"includes":aZ(c,RegExp(aW(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&aY(c,"ipv4",d.message,b),"v4"!==d.version&&aY(c,"ipv6",d.message,b);break;case"base64url":aZ(c,aU.base64url,d.message,b);break;case"jwt":aZ(c,aU.jwt,d.message,b);break;case"cidr":"v6"!==d.version&&aZ(c,aU.ipv4Cidr,d.message,b),"v4"!==d.version&&aZ(c,aU.ipv6Cidr,d.message,b);break;case"emoji":aZ(c,aU.emoji(),d.message,b);break;case"ulid":aZ(c,aU.ulid,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":aY(c,"binary",d.message,b);break;case"contentEncoding:base64":aS(c,"contentEncoding","base64",d.message,b);break;case"pattern:zod":aZ(c,aU.base64,d.message,b)}break;case"nanoid":aZ(c,aU.nanoid,d.message,b)}return c}function aW(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)aX.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}let aX=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function aY(a,b,c,d){a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&d.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):aS(a,"format",b,c,d)}function aZ(a,b,c,d){a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&d.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:a$(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):aS(a,"pattern",a$(b,d),c,d)}function a$(a,b){if(!b.applyRegexFlags||!a.flags)return a.source;let c={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},d=c.i?a.source.toLowerCase():a.source,e="",f=!1,g=!1,h=!1;for(let a=0;a<d.length;a++){if(f){e+=d[a],f=!1;continue}if(c.i){if(g){if(d[a].match(/[a-z]/)){h?(e+=d[a],e+=`${d[a-2]}-${d[a]}`.toUpperCase(),h=!1):"-"===d[a+1]&&d[a+2]?.match(/[a-z]/)?(e+=d[a],h=!0):e+=`${d[a]}${d[a].toUpperCase()}`;continue}}else if(d[a].match(/[a-z]/)){e+=`[${d[a]}${d[a].toUpperCase()}]`;continue}}if(c.m){if("^"===d[a]){e+=`(^|(?<=[\r
]))`;continue}else if("$"===d[a]){e+=`($|(?=[\r
]))`;continue}}if(c.s&&"."===d[a]){e+=g?`${d[a]}\r
`:`[${d[a]}\r
]`;continue}e+=d[a],"\\"===d[a]?f=!0:g&&"]"===d[a]?g=!1:g||"["!==d[a]||(g=!0)}try{new RegExp(e)}catch{return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return e}function a_(a,b){if("openAi"===b.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===b.target&&a.keyType?._def.typeName===m.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((c,d)=>({...c,[d]:a2(a.valueType._def,{...b,currentPath:[...b.currentPath,"properties",d]})??aQ(b)}),{}),additionalProperties:b.rejectedAdditionalProperties};let c={type:"object",additionalProperties:a2(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]})??b.allowedAdditionalProperties};if("openApi3"===b.target)return c;if(a.keyType?._def.typeName===m.ZodString&&a.keyType._def.checks?.length){let{type:d,...e}=aV(a.keyType._def,b);return{...c,propertyNames:e}}if(a.keyType?._def.typeName===m.ZodEnum)return{...c,propertyNames:{enum:a.keyType._def.values}};if(a.keyType?._def.typeName===m.ZodBranded&&a.keyType._def.type._def.typeName===m.ZodString&&a.keyType._def.type._def.checks?.length){let{type:d,...e}=aT(a.keyType._def,b);return{...c,propertyNames:e}}return c}let a0={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},a1=(a,b)=>{let c=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,c)=>a2(a._def,{...b,currentPath:[...b.currentPath,"anyOf",`${c}`]})).filter(a=>!!a&&(!b.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return c.length?{anyOf:c}:void 0};function a2(a,b,c=!1){let d=b.seen.get(a);if(b.override){let e=b.override?.(a,b,d,c);if(e!==aN)return e}if(d&&!c){let a=a3(d,b);if(void 0!==a)return a}let e={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,e);let f=((a,b,c)=>{switch(b){case m.ZodString:return aV(a,c);case m.ZodNumber:var d,e,f,g,h,i,j,k,l,n=a,o=c;let p={type:"number"};if(!n.checks)return p;for(let a of n.checks)switch(a.kind){case"int":p.type="integer",aR(p,"type",a.message,o);break;case"min":"jsonSchema7"===o.target?a.inclusive?aS(p,"minimum",a.value,a.message,o):aS(p,"exclusiveMinimum",a.value,a.message,o):(a.inclusive||(p.exclusiveMinimum=!0),aS(p,"minimum",a.value,a.message,o));break;case"max":"jsonSchema7"===o.target?a.inclusive?aS(p,"maximum",a.value,a.message,o):aS(p,"exclusiveMaximum",a.value,a.message,o):(a.inclusive||(p.exclusiveMaximum=!0),aS(p,"maximum",a.value,a.message,o));break;case"multipleOf":aS(p,"multipleOf",a.value,a.message,o)}return p;case m.ZodObject:return function(a,b){let c="openAi"===b.target,d={type:"object",properties:{}},e=[],f=a.shape();for(let a in f){let g=f[a];if(void 0===g||void 0===g._def)continue;let h=function(a){try{return a.isOptional()}catch{return!0}}(g);h&&c&&("ZodOptional"===g._def.typeName&&(g=g._def.innerType),g.isNullable()||(g=g.nullable()),h=!1);let i=a2(g._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==i&&(d.properties[a]=i,h||e.push(a))}e.length&&(d.required=e);let g=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return a2(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==g&&(d.additionalProperties=g),d}(a,c);case m.ZodBigInt:var q=a,r=c;let s={type:"integer",format:"int64"};if(!q.checks)return s;for(let a of q.checks)switch(a.kind){case"min":"jsonSchema7"===r.target?a.inclusive?aS(s,"minimum",a.value,a.message,r):aS(s,"exclusiveMinimum",a.value,a.message,r):(a.inclusive||(s.exclusiveMinimum=!0),aS(s,"minimum",a.value,a.message,r));break;case"max":"jsonSchema7"===r.target?a.inclusive?aS(s,"maximum",a.value,a.message,r):aS(s,"exclusiveMaximum",a.value,a.message,r):(a.inclusive||(s.exclusiveMaximum=!0),aS(s,"maximum",a.value,a.message,r));break;case"multipleOf":aS(s,"multipleOf",a.value,a.message,r)}return s;case m.ZodBoolean:return{type:"boolean"};case m.ZodDate:return function a(b,c,d){let e=d??c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b,g=c;let h={type:"integer",format:"unix-time"};if("openApi3"===g.target)return h;for(let a of f.checks)switch(a.kind){case"min":aS(h,"minimum",a.value,a.message,g);break;case"max":aS(h,"maximum",a.value,a.message,g)}return h}}(a,c);case m.ZodUndefined:return{not:aQ(c)};case m.ZodNull:return"openApi3"===c.target?{enum:["null"],nullable:!0}:{type:"null"};case m.ZodArray:var t=a,u=c;let v={type:"array"};return t.type?._def&&t.type?._def?.typeName!==m.ZodAny&&(v.items=a2(t.type._def,{...u,currentPath:[...u.currentPath,"items"]})),t.minLength&&aS(v,"minItems",t.minLength.value,t.minLength.message,u),t.maxLength&&aS(v,"maxItems",t.maxLength.value,t.maxLength.message,u),t.exactLength&&(aS(v,"minItems",t.exactLength.value,t.exactLength.message,u),aS(v,"maxItems",t.exactLength.value,t.exactLength.message,u)),v;case m.ZodUnion:case m.ZodDiscriminatedUnion:var w=a,x=c;if("openApi3"===x.target)return a1(w,x);let y=w.options instanceof Map?Array.from(w.options.values()):w.options;if(y.every(a=>a._def.typeName in a0&&(!a._def.checks||!a._def.checks.length))){let a=y.reduce((a,b)=>{let c=a0[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(y.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=y.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===y.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:y.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(y.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:y.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};return a1(w,x);case m.ZodIntersection:var z=a,A=c;let B=[a2(z.left._def,{...A,currentPath:[...A.currentPath,"allOf","0"]}),a2(z.right._def,{...A,currentPath:[...A.currentPath,"allOf","1"]})].filter(a=>!!a),C="jsonSchema2019-09"===A.target?{unevaluatedProperties:!1}:void 0,D=[];return B.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)D.push(...a.allOf),void 0===a.unevaluatedProperties&&(C=void 0);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}else C=void 0;D.push(b)}}),D.length?{allOf:D,...C}:void 0;case m.ZodTuple:return d=a,e=c,d.rest?{type:"array",minItems:d.items.length,items:d.items.map((a,b)=>a2(a._def,{...e,currentPath:[...e.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:a2(d.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:d.items.length,maxItems:d.items.length,items:d.items.map((a,b)=>a2(a._def,{...e,currentPath:[...e.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case m.ZodRecord:return a_(a,c);case m.ZodLiteral:var E=a,F=c;let G=typeof E.value;return"bigint"!==G&&"number"!==G&&"boolean"!==G&&"string"!==G?{type:Array.isArray(E.value)?"array":"object"}:"openApi3"===F.target?{type:"bigint"===G?"integer":G,enum:[E.value]}:{type:"bigint"===G?"integer":G,const:E.value};case m.ZodEnum:return{type:"string",enum:Array.from(a.values)};case m.ZodNativeEnum:var H=a;let I=H.values,J=Object.keys(H.values).filter(a=>"number"!=typeof I[I[a]]).map(a=>I[a]),K=Array.from(new Set(J.map(a=>typeof a)));return{type:1===K.length?"string"===K[0]?"string":"number":["string","number"],enum:J};case m.ZodNullable:var L=a,M=c;if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(L.innerType._def.typeName)&&(!L.innerType._def.checks||!L.innerType._def.checks.length))return"openApi3"===M.target?{type:a0[L.innerType._def.typeName],nullable:!0}:{type:[a0[L.innerType._def.typeName],"null"]};if("openApi3"===M.target){let a=a2(L.innerType._def,{...M,currentPath:[...M.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}let N=a2(L.innerType._def,{...M,currentPath:[...M.currentPath,"anyOf","0"]});return N&&{anyOf:[N,{type:"null"}]};case m.ZodOptional:var O=a,P=c;if(P.currentPath.toString()===P.propertyPath?.toString())return a2(O.innerType._def,P);let Q=a2(O.innerType._def,{...P,currentPath:[...P.currentPath,"anyOf","1"]});return Q?{anyOf:[{not:aQ(P)},Q]}:aQ(P);case m.ZodMap:return f=a,"record"===(g=c).mapStrategy?a_(f,g):{type:"array",maxItems:125,items:{type:"array",items:[a2(f.keyType._def,{...g,currentPath:[...g.currentPath,"items","items","0"]})||aQ(g),a2(f.valueType._def,{...g,currentPath:[...g.currentPath,"items","items","1"]})||aQ(g)],minItems:2,maxItems:2}};case m.ZodSet:var R=a,S=c;let T={type:"array",uniqueItems:!0,items:a2(R.valueType._def,{...S,currentPath:[...S.currentPath,"items"]})};return R.minSize&&aS(T,"minItems",R.minSize.value,R.minSize.message,S),R.maxSize&&aS(T,"maxItems",R.maxSize.value,R.maxSize.message,S),T;case m.ZodLazy:return()=>a.getter()._def;case m.ZodPromise:return a2(a.type._def,c);case m.ZodNaN:case m.ZodNever:return"openAi"===(h=c).target?void 0:{not:aQ({...h,currentPath:[...h.currentPath,"not"]})};case m.ZodEffects:return i=a,"input"===(j=c).effectStrategy?a2(i.schema._def,j):aQ(j);case m.ZodAny:case m.ZodUnknown:return aQ(c);case m.ZodDefault:return k=a,l=c,{...a2(k.innerType._def,l),default:k.defaultValue()};case m.ZodBranded:return aT(a,c);case m.ZodReadonly:case m.ZodCatch:return a2(a.innerType._def,c);case m.ZodPipeline:var U=a,V=c;if("input"===V.pipeStrategy)return a2(U.in._def,V);if("output"===V.pipeStrategy)return a2(U.out._def,V);let W=a2(U.in._def,{...V,currentPath:[...V.currentPath,"allOf","0"]}),X=a2(U.out._def,{...V,currentPath:[...V.currentPath,"allOf",W?"1":"0"]});return{allOf:[W,X].filter(a=>void 0!==a)};case m.ZodFunction:case m.ZodVoid:case m.ZodSymbol:default:return}})(a,a.typeName,b),g="function"==typeof f?a2(f(),b):f;if(g&&a4(a,b,g),b.postProcess){let c=b.postProcess(g,a,b);return e.jsonSchema=g,c}return e.jsonSchema=g,g}let a3=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:aP(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),aQ(b);return"seen"===b.$refStrategy?aQ(b):void 0}},a4=(a,b,c)=>(a.description&&(c.description=a.description,b.markdownDescription&&(c.markdownDescription=a.description)),c);function a5(...a){return a.reduce((a,b)=>({...a,...null!=b?b:{}}),{})}async function a6(a){return null==a?Promise.resolve():new Promise(b=>setTimeout(b,a))}function a7(a){return Object.fromEntries([...a.headers])}var a8=({prefix:a,size:b=16,alphabet:c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:d="-"}={})=>{let e=()=>{let a=c.length,d=Array(b);for(let e=0;e<b;e++)d[e]=c[Math.random()*a|0];return d.join("")};if(null==a)return e;if(c.includes(d))throw new ap({argument:"separator",message:`The separator "${d}" must not be part of the alphabet "${c}".`});return()=>`${a}${d}${e()}`},a9=a8();function ba(a){return a instanceof Error&&("AbortError"===a.name||"ResponseAborted"===a.name||"TimeoutError"===a.name)}var bb=["fetch failed","failed to fetch"];function bc({error:a,url:b,requestBodyValues:c}){if(ba(a))return a;if(a instanceof TypeError&&bb.includes(a.message.toLowerCase())){let d=a.cause;if(null!=d)return new ag({message:`Cannot connect to API: ${d.message}`,cause:d,url:b,requestBodyValues:c,isRetryable:!0})}return a}function bd(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>null!=b))}var be=()=>globalThis.fetch,bf=async({url:a,headers:b={},successfulResponseHandler:c,failedResponseHandler:d,abortSignal:e,fetch:f=be()})=>{try{let g=await f(a,{method:"GET",headers:bd(b),signal:e}),h=a7(g);if(!g.ok){let b;try{b=await d({response:g,url:a,requestBodyValues:{}})}catch(b){if(ba(b)||ag.isInstance(b))throw b;throw new ag({message:"Failed to process error response",cause:b,statusCode:g.status,url:a,responseHeaders:h,requestBodyValues:{}})}throw b.value}try{return await c({response:g,url:a,requestBodyValues:{}})}catch(b){if(b instanceof Error&&(ba(b)||ag.isInstance(b)))throw b;throw new ag({message:"Failed to process successful response",cause:b,statusCode:g.status,url:a,responseHeaders:h,requestBodyValues:{}})}}catch(b){throw bc({error:b,url:a,requestBodyValues:{}})}};function bg({settingValue:a,environmentVariableName:b}){return"string"==typeof a?a:null!=a||"undefined"==typeof process?void 0:null!=(a=process.env[b])&&"string"==typeof a?a:void 0}var bh=/"__proto__"\s*:/,bi=/"constructor"\s*:/;function bj(a){let{stackTraceLimit:b}=Error;Error.stackTraceLimit=0;try{let b=JSON.parse(a);return null===b||"object"!=typeof b||!1===bh.test(a)&&!1===bi.test(a)?b:function(a){let b=[a];for(;b.length;){let a=b;for(let c of(b=[],a)){if(Object.prototype.hasOwnProperty.call(c,"__proto__")||Object.prototype.hasOwnProperty.call(c,"constructor")&&Object.prototype.hasOwnProperty.call(c.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let a in c){let d=c[a];d&&"object"==typeof d&&b.push(d)}}}return a}(b)}finally{Error.stackTraceLimit=b}}var bk=Symbol.for("vercel.ai.validator");async function bl({value:a,schema:b}){let c=await bm({value:a,schema:b});if(!c.success)throw aF.wrap({value:a,cause:c.error});return c.value}async function bm({value:a,schema:b}){var c;let d="object"==typeof b&&null!==b&&bk in b&&!0===b[bk]&&"validate"in b?b:(c=b,{[bk]:!0,validate:async a=>{let b=await c["~standard"].validate(a);return null==b.issues?{success:!0,value:b.value}:{success:!1,error:new aF({value:a,cause:b.issues})}}});try{if(null==d.validate)return{success:!0,value:a,rawValue:a};let b=await d.validate(a);if(b.success)return{success:!0,value:b.value,rawValue:a};return{success:!1,error:aF.wrap({value:a,cause:b.error}),rawValue:a}}catch(b){return{success:!1,error:aF.wrap({value:a,cause:b}),rawValue:a}}}async function bn({text:a,schema:b}){try{let c=bj(a);if(null==b)return c;return bl({value:c,schema:b})}catch(b){if(ax.isInstance(b)||aF.isInstance(b))throw b;throw new ax({text:a,cause:b})}}async function bo({text:a,schema:b}){try{let c=bj(a);if(null==b)return{success:!0,value:c,rawValue:c};return await bm({value:c,schema:b})}catch(b){return{success:!1,error:ax.isInstance(b)?b:new ax({text:a,cause:b}),rawValue:void 0}}}var bp=()=>globalThis.fetch,bq=async({url:a,headers:b,body:c,failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g})=>br({url:a,headers:{"Content-Type":"application/json",...b},body:{content:JSON.stringify(c),values:c},failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g}),br=async({url:a,headers:b={},body:c,successfulResponseHandler:d,failedResponseHandler:e,abortSignal:f,fetch:g=bp()})=>{try{let h=await g(a,{method:"POST",headers:bd(b),body:c.content,signal:f}),i=a7(h);if(!h.ok){let b;try{b=await e({response:h,url:a,requestBodyValues:c.values})}catch(b){if(ba(b)||ag.isInstance(b))throw b;throw new ag({message:"Failed to process error response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}throw b.value}try{return await d({response:h,url:a,requestBodyValues:c.values})}catch(b){if(b instanceof Error&&(ba(b)||ag.isInstance(b)))throw b;throw new ag({message:"Failed to process successful response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}}catch(b){throw bc({error:b,url:a,requestBodyValues:c.values})}};async function bs(a){return"function"==typeof a&&(a=a()),Promise.resolve(a)}var bt=({errorSchema:a,errorToMessage:b,isRetryable:c})=>async({response:d,url:e,requestBodyValues:f})=>{let g=await d.text(),h=a7(d);if(""===g.trim())return{responseHeaders:h,value:new ag({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})};try{let i=await bn({text:g,schema:a});return{responseHeaders:h,value:new ag({message:b(i),url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,data:i,isRetryable:null==c?void 0:c(d,i)})}}catch(a){return{responseHeaders:h,value:new ag({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})}}},bu=a=>async({response:b,url:c,requestBodyValues:d})=>{let e=await b.text(),f=await bo({text:e,schema:a}),g=a7(b);if(!f.success)throw new ag({message:"Invalid JSON response",cause:f.error,statusCode:b.status,responseHeaders:g,responseBody:e,url:c,requestBodyValues:d});return{responseHeaders:g,value:f.value,rawValue:f.rawValue}},bv=Symbol.for("vercel.ai.schema");function bw(a,{validate:b}={}){return{[bv]:!0,_type:void 0,[bk]:!0,jsonSchema:a,validate:b}}function bx(a){return null==a?bw({properties:{},additionalProperties:!1}):"object"==typeof a&&null!==a&&bv in a&&!0===a[bv]&&"jsonSchema"in a&&"validate"in a?a:function(a,b){var c;return"_zod"in a?bw(function(a,b){if(a instanceof aJ.rs){let c=new aL(b),d={};for(let b of a._idmap.entries()){let[a,d]=b;c.process(d)}let e={},f={registry:a,uri:b?.uri,defs:d};for(let d of a._idmap.entries()){let[a,g]=d;e[a]=c.emit(g,{...b,external:f})}return Object.keys(d).length>0&&(e.__shared={["draft-2020-12"===c.target?"$defs":"definitions"]:d}),{schemas:e}}let c=new aL(b);return c.process(a),c.emit(a,b)}(a,{target:"draft-7",io:"output",reused:"inline"}),{validate:async b=>{let c=await aM.bp(a,b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}}):bw(((a,b)=>{let c=(a=>{let b,c="string"==typeof(b=a)?{...aO,name:b}:{...aO,...b},d=void 0!==c.name?[...c.basePath,c.definitionPath,c.name]:c.basePath;return{...c,flags:{hasReferencedOpenAiAnyType:!1},currentPath:d,propertyPath:void 0,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[b._def,{def:b._def,path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}})(b),d="object"==typeof b&&b.definitions?Object.entries(b.definitions).reduce((a,[b,d])=>({...a,[b]:a2(d._def,{...c,currentPath:[...c.basePath,c.definitionPath,b]},!0)??aQ(c)}),{}):void 0,e="string"==typeof b?b:b?.nameStrategy==="title"?void 0:b?.name,f=a2(a._def,void 0===e?c:{...c,currentPath:[...c.basePath,c.definitionPath,e]},!1)??aQ(c),g="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==g&&(f.title=g),c.flags.hasReferencedOpenAiAnyType&&(d||(d={}),d[c.openAiAnyTypeName]||(d[c.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===c.$refStrategy?"1":[...c.basePath,c.definitionPath,c.openAiAnyTypeName].join("/")}}));let h=void 0===e?d?{...f,[c.definitionPath]:d}:f:{$ref:[..."relative"===c.$refStrategy?[]:c.basePath,c.definitionPath,e].join("/"),[c.definitionPath]:{...d,[e]:f}};return"jsonSchema7"===c.target?h.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===c.target||"openAi"===c.target)&&(h.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===c.target&&("anyOf"in h||"oneOf"in h||"allOf"in h||"type"in h&&Array.isArray(h.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),h})(a,{$refStrategy:(c=void 0,"none"),target:"jsonSchema7"}),{validate:async b=>{let c=await a.safeParseAsync(b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}})}(a)}var{btoa:by,atob:bz}=globalThis;function bA(a){let b=bz(a.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(b,a=>a.codePointAt(0))}function bB(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCodePoint(a[c]);return by(b)}var bC=c(5692),bD=Symbol.for("vercel.ai.gateway.error"),bE=class a extends(o=Error,n=bD,o){constructor({message:a,statusCode:b=500,cause:c}){super(a),this[n]=!0,this.statusCode=b,this.cause=c}static isInstance(b){return a.hasMarker(b)}static hasMarker(a){return"object"==typeof a&&null!==a&&bD in a&&!0===a[bD]}},bF="GatewayAuthenticationError",bG=Symbol.for(`vercel.ai.gateway.error.${bF}`),bH=class a extends(q=bE,p=bG,q){constructor({message:a="Authentication failed",statusCode:b=401,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[p]=!0,this.name=bF,this.type="authentication_error"}static isInstance(a){return bE.hasMarker(a)&&bG in a}static createContextualError({apiKeyProvided:b,oidcTokenProvided:c,message:d="Authentication failed",statusCode:e=401,cause:f}){return new a({message:b?`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:c?`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`,statusCode:e,cause:f})}},bI="GatewayInvalidRequestError",bJ=Symbol.for(`vercel.ai.gateway.error.${bI}`),bK=class extends(s=bE,r=bJ,s){constructor({message:a="Invalid request",statusCode:b=400,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[r]=!0,this.name=bI,this.type="invalid_request_error"}static isInstance(a){return bE.hasMarker(a)&&bJ in a}},bL="GatewayRateLimitError",bM=Symbol.for(`vercel.ai.gateway.error.${bL}`),bN=class extends(u=bE,t=bM,u){constructor({message:a="Rate limit exceeded",statusCode:b=429,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[t]=!0,this.name=bL,this.type="rate_limit_exceeded"}static isInstance(a){return bE.hasMarker(a)&&bM in a}},bO="GatewayModelNotFoundError",bP=Symbol.for(`vercel.ai.gateway.error.${bO}`),bQ=bC.Ik({modelId:bC.Yj()}),bR=class extends(w=bE,v=bP,w){constructor({message:a="Model not found",statusCode:b=404,modelId:c,cause:d}={}){super({message:a,statusCode:b,cause:d}),this[v]=!0,this.name=bO,this.type="model_not_found",this.modelId=c}static isInstance(a){return bE.hasMarker(a)&&bP in a}},bS="GatewayInternalServerError",bT=Symbol.for(`vercel.ai.gateway.error.${bS}`),bU=class extends(y=bE,x=bT,y){constructor({message:a="Internal server error",statusCode:b=500,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[x]=!0,this.name=bS,this.type="internal_server_error"}static isInstance(a){return bE.hasMarker(a)&&bT in a}},bV="GatewayResponseError",bW=Symbol.for(`vercel.ai.gateway.error.${bV}`),bX=class extends(A=bE,z=bW,A){constructor({message:a="Invalid response from Gateway",statusCode:b=502,response:c,validationError:d,cause:e}={}){super({message:a,statusCode:b,cause:e}),this[z]=!0,this.name=bV,this.type="response_error",this.response=c,this.validationError=d}static isInstance(a){return bE.hasMarker(a)&&bW in a}};function bY({response:a,statusCode:b,defaultMessage:c="Gateway request failed",cause:d,authMethod:e}){let f=bZ.safeParse(a);if(!f.success)return new bX({message:`Invalid error response format: ${c}`,statusCode:b,response:a,validationError:f.error,cause:d});let g=f.data,h=g.error.type,i=g.error.message;switch(h){case"authentication_error":return bH.createContextualError({apiKeyProvided:"api-key"===e,oidcTokenProvided:"oidc"===e,statusCode:b,cause:d});case"invalid_request_error":return new bK({message:i,statusCode:b,cause:d});case"rate_limit_exceeded":return new bN({message:i,statusCode:b,cause:d});case"model_not_found":{let a=bQ.safeParse(g.error.param);return new bR({message:i,statusCode:b,modelId:a.success?a.data.modelId:void 0,cause:d})}default:return new bU({message:i,statusCode:b,cause:d})}}var bZ=bC.Ik({error:bC.Ik({message:bC.Yj(),type:bC.Yj().nullish(),param:bC.L5().nullish(),code:bC.KC([bC.Yj(),bC.ai()]).nullish()})});function b$(a,b){var c;return bE.isInstance(a)?a:ag.isInstance(a)?bY({response:function(a){if(void 0!==a.data)return a.data;if(null!=a.responseBody)try{return JSON.parse(a.responseBody)}catch(b){return a.responseBody}return{}}(a),statusCode:null!=(c=a.statusCode)?c:500,defaultMessage:"Gateway request failed",cause:a,authMethod:b}):bY({response:{},statusCode:500,defaultMessage:a instanceof Error?`Gateway request failed: ${a.message}`:"Unknown Gateway error",cause:a,authMethod:b})}var b_="ai-gateway-auth-method";function b0(a){let b=b1.safeParse(a[b_]);return b.success?b.data:void 0}var b1=bC.KC([bC.eu("api-key"),bC.eu("oidc")]),b2=class{constructor(a){this.config=a}async getAvailableModels(){try{let{value:a}=await bf({url:`${this.config.baseURL}/config`,headers:await bs(this.config.headers()),successfulResponseHandler:bu(b6),failedResponseHandler:bt({errorSchema:bC.bz(),errorToMessage:a=>a}),fetch:this.config.fetch});return a}catch(a){throw b$(a)}}},b3=bC.Ik({specificationVersion:bC.eu("v2"),provider:bC.Yj(),modelId:bC.Yj()}),b4=bC.Ik({input:bC.Yj(),output:bC.Yj()}),b5=bC.Ik({id:bC.Yj(),name:bC.Yj(),description:bC.Yj().nullish(),pricing:b4.nullish(),specification:b3}),b6=bC.Ik({models:bC.YO(b5)}),b7=class{constructor(a,b){this.modelId=a,this.config=b,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async doGenerate(a){let{abortSignal:b,...c}=a,d=await bs(this.config.headers());try{let{responseHeaders:e,value:f,rawValue:g}=await bq({url:this.getUrl(),headers:a5(d,a.headers,this.getModelConfigHeaders(this.modelId,!1),await bs(this.config.o11yHeaders)),body:this.maybeEncodeFileParts(c),successfulResponseHandler:bu(bC.bz()),failedResponseHandler:bt({errorSchema:bC.bz(),errorToMessage:a=>a}),...b&&{abortSignal:b},fetch:this.config.fetch});return{...f,request:{body:c},response:{headers:e,body:g},warnings:[]}}catch(a){throw b$(a,b0(d))}}async doStream(a){let{abortSignal:b,...c}=a,d=await bs(this.config.headers());try{let e,{value:f,responseHeaders:g}=await bq({url:this.getUrl(),headers:a5(d,a.headers,this.getModelConfigHeaders(this.modelId,!0),await bs(this.config.o11yHeaders)),body:this.maybeEncodeFileParts(c),successfulResponseHandler:(e=bC.bz(),async({response:a})=>{let b=a7(a);if(null==a.body)throw new ak({});return{responseHeaders:b,value:function({stream:a,schema:b}){return a.pipeThrough(new TextDecoderStream).pipeThrough(new aI).pipeThrough(new TransformStream({async transform({data:a},c){"[DONE]"!==a&&c.enqueue(await bo({text:a,schema:b}))}}))}({stream:a.body,schema:e})}}),failedResponseHandler:bt({errorSchema:bC.bz(),errorToMessage:a=>a}),...b&&{abortSignal:b},fetch:this.config.fetch});return{stream:f.pipeThrough(new TransformStream({transform(b,c){if(b.success){let d=b.value;("raw"!==d.type||a.includeRawChunks)&&("response-metadata"===d.type&&d.timestamp&&"string"==typeof d.timestamp&&(d.timestamp=new Date(d.timestamp)),c.enqueue(d))}else c.error(b.error)}})),request:{body:c},response:{headers:g}}}catch(a){throw b$(a,b0(d))}}isFilePart(a){return a&&"object"==typeof a&&"type"in a&&"file"===a.type}maybeEncodeFileParts(a){for(let b of a.prompt)for(let a of b.content)if(this.isFilePart(a)&&a.data instanceof Uint8Array){let b=Uint8Array.from(a.data),c=Buffer.from(b).toString("base64");a.data=new URL(`data:${a.mediaType||"application/octet-stream"};base64,${c}`)}return a}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(a,b){return{"ai-language-model-specification-version":"2","ai-language-model-id":a,"ai-language-model-streaming":String(b)}}};async function b8(){var a,b;let c=null!=(b=null==(a=cb().headers)?void 0:a["x-vercel-oidc-token"])?b:process.env.VERCEL_OIDC_TOKEN;if(!c)throw new bH({message:"OIDC token not available",statusCode:401});return c}async function b9(){var a;return null==(a=cb().headers)?void 0:a["x-vercel-id"]}var ca=Symbol.for("@vercel/request-context");function cb(){var a,b,c;return null!=(c=null==(b=null==(a=globalThis[ca])?void 0:a.get)?void 0:b.call(a))?c:{}}var cc=function(a={}){var b,c,d;let e=null,f=null,g=null!=(b=a.metadataCacheRefreshMillis)?b:3e5,h=0,i=null!=(c=null==(d=a.baseURL)?void 0:d.replace(/\/$/,""))?c:"https://ai-gateway.vercel.sh/v1/ai",j=async()=>{let b=await cd(a);if(b)return{Authorization:`Bearer ${b.token}`,"ai-gateway-protocol-version":"0.0.1",[b_]:b.authMethod,...a.headers};throw bH.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},k=b=>{let c=bg({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),d=bg({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),e=bg({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return new b7(b,{provider:"gateway",baseURL:i,headers:j,fetch:a.fetch,o11yHeaders:async()=>{let a=await b9();return{...c&&{"ai-o11y-deployment-id":c},...d&&{"ai-o11y-environment":d},...e&&{"ai-o11y-region":e},...a&&{"ai-o11y-request-id":a}}}})},l=function(a){if(new.target)throw Error("The Gateway Provider model function cannot be called with the new keyword.");return k(a)};return l.getAvailableModels=async()=>{var b,c,d;let k=null!=(d=null==(c=null==(b=a._internal)?void 0:b.currentDate)?void 0:c.call(b).getTime())?d:Date.now();return(!e||k-h>g)&&(h=k,e=new b2({baseURL:i,headers:j,fetch:a.fetch}).getAvailableModels().then(a=>(f=a,a)).catch(async a=>{throw b$(a,b0(await j()))})),f?Promise.resolve(f):e},l.imageModel=a=>{throw new aB({modelId:a,modelType:"imageModel"})},l.languageModel=k,l.textEmbeddingModel=a=>{throw new aB({modelId:a,modelType:"textEmbeddingModel"})},l}();async function cd(a){let b=bg({settingValue:a.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(b)return{token:b,authMethod:"api-key"};try{return{token:await b8(),authMethod:"oidc"}}catch(a){return null}}var ce=c(9628),cf=c(7610),cg=Object.defineProperty,ch="AI_NoOutputSpecifiedError",ci=`vercel.ai.error.${ch}`,cj=Symbol.for(ci),ck=class extends ac{constructor({message:a="No output specified."}={}){super({name:ch,message:a}),this[B]=!0}static isInstance(a){return ac.hasMarker(a,ci)}};function cl(a){return void 0===a?[]:Array.isArray(a)?a:[a]}B=cj;var cm="AI_InvalidArgumentError",cn=`vercel.ai.error.${cm}`,co=Symbol.for(cn),cp=class extends ac{constructor({parameter:a,value:b,message:c}){super({name:cm,message:`Invalid argument for parameter ${a}: ${c}`}),this[C]=!0,this.parameter=a,this.value=b}static isInstance(a){return ac.hasMarker(a,cn)}};C=co;var cq="AI_RetryError",cr=`vercel.ai.error.${cq}`,cs=Symbol.for(cr),ct=class extends ac{constructor({message:a,reason:b,errors:c}){super({name:cq,message:a}),this[D]=!0,this.reason=b,this.errors=c,this.lastError=c[c.length-1]}static isInstance(a){return ac.hasMarker(a,cr)}};async function cu(a,{maxRetries:b,delayInMs:c,backoffFactor:d},e=[]){try{return await a()}catch(i){if(ba(i)||0===b)throw i;let f=null==i?"unknown error":"string"==typeof i?i:i instanceof Error?i.message:JSON.stringify(i),g=[...e,i],h=g.length;if(h>b)throw new ct({message:`Failed after ${h} attempts. Last error: ${f}`,reason:"maxRetriesExceeded",errors:g});if(i instanceof Error&&ag.isInstance(i)&&!0===i.isRetryable&&h<=b){let e=function(a,b){let c,d=a.responseHeaders;if(!d)return b;let e=d["retry-after-ms"];if(e){let a=parseFloat(e);Number.isNaN(a)||(c=a)}let f=d["retry-after"];if(f&&void 0===c){let a=parseFloat(f);c=Number.isNaN(a)?Date.parse(f)-Date.now():1e3*a}return void 0!==c&&0<=c&&c<6e4?c:b}(i,c);return await a6(e),cu(a,{maxRetries:b,delayInMs:d*c,backoffFactor:d},g)}if(1===h)throw i;throw new ct({message:`Failed after ${h} attempts with non-retryable error: '${f}'`,reason:"errorNotRetryable",errors:g})}}D=cs;var cv=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],cw="AI_DownloadError",cx=`vercel.ai.error.${cw}`,cy=Symbol.for(cx),cz=class extends ac{constructor({url:a,statusCode:b,statusText:c,cause:d,message:e=null==d?`Failed to download ${a}: ${b} ${c}`:`Failed to download ${a}: ${d}`}){super({name:cw,message:e,cause:d}),this[E]=!0,this.url=a,this.statusCode=b,this.statusText=c}static isInstance(a){return ac.hasMarker(a,cx)}};async function cA({url:a}){var b;let c=a.toString();try{let a=await fetch(c);if(!a.ok)throw new cz({url:c,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mediaType:null!=(b=a.headers.get("content-type"))?b:void 0}}catch(a){if(cz.isInstance(a))throw a;throw new cz({url:c,cause:a})}}E=cy,Symbol.for("vercel.ai.error.AI_InvalidDataContentError");var cB=bC.KC([bC.Yj(),bC.Nl(Uint8Array),bC.Nl(ArrayBuffer),bC.Ie(a=>{var b,c;return null!=(c=null==(b=globalThis.Buffer)?void 0:b.isBuffer(a))&&c},{message:"Must be a Buffer"})]);function cC(a){if(a instanceof Uint8Array)return{data:a,mediaType:void 0};if(a instanceof ArrayBuffer)return{data:new Uint8Array(a),mediaType:void 0};if("string"==typeof a)try{a=new URL(a)}catch(a){}if(a instanceof URL&&"data:"===a.protocol){let{mediaType:b,base64Content:c}=function(a){try{let[b,c]=a.split(",");return{mediaType:b.split(";")[0].split(":")[1],base64Content:c}}catch(a){return{mediaType:void 0,base64Content:void 0}}}(a.toString());if(null==b||null==c)throw new ac({name:"InvalidDataContentError",message:`Invalid data URL format in content ${a.toString()}`});return{data:c,mediaType:b}}return{data:a,mediaType:void 0}}var cD="AI_InvalidMessageRoleError",cE=`vercel.ai.error.${cD}`,cF=Symbol.for(cE),cG=class extends ac{constructor({role:a,message:b=`Invalid message role: '${a}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:cD,message:b}),this[F]=!0,this.role=a}static isInstance(a){return ac.hasMarker(a,cE)}};async function cH({prompt:a,supportedUrls:b,downloadImplementation:c=cA}){let d=await cI(a.messages,c,b);return[...null!=a.system?[{role:"system",content:a.system}]:[],...a.messages.map(a=>(function({message:a,downloadedAssets:b}){let c=a.role;switch(c){case"system":return{role:"system",content:a.content,providerOptions:a.providerOptions};case"user":if("string"==typeof a.content)return{role:"user",content:[{type:"text",text:a.content}],providerOptions:a.providerOptions};return{role:"user",content:a.content.map(a=>(function(a,b){var c;let d;if("text"===a.type)return{type:"text",text:a.text,providerOptions:a.providerOptions};let e=a.type;switch(e){case"image":d=a.image;break;case"file":d=a.data;break;default:throw Error(`Unsupported part type: ${e}`)}let{data:f,mediaType:g}=cC(d),h=null!=g?g:a.mediaType,i=f;if(i instanceof URL){let a=b[i.toString()];a&&(i=a.data,null!=h||(h=a.mediaType))}switch(e){case"image":return(i instanceof Uint8Array||"string"==typeof i)&&(h=null!=(c=function({data:a,signatures:b}){let c="string"==typeof a&&a.startsWith("SUQz")||"string"!=typeof a&&a.length>10&&73===a[0]&&68===a[1]&&51===a[2]?(a=>{let b="string"==typeof a?bA(a):a,c=(127&b[6])<<21|(127&b[7])<<14|(127&b[8])<<7|127&b[9];return b.slice(c+10)})(a):a;for(let a of b)if("string"==typeof c?c.startsWith(a.base64Prefix):c.length>=a.bytesPrefix.length&&a.bytesPrefix.every((a,b)=>c[b]===a))return a.mediaType}({data:i,signatures:cv}))?c:h),{type:"file",mediaType:null!=h?h:"image/*",filename:void 0,data:i,providerOptions:a.providerOptions};case"file":if(null==h)throw Error("Media type is missing for file part");return{type:"file",mediaType:h,filename:a.filename,data:i,providerOptions:a.providerOptions}}})(a,b)).filter(a=>"text"!==a.type||""!==a.text),providerOptions:a.providerOptions};case"assistant":if("string"==typeof a.content)return{role:"assistant",content:[{type:"text",text:a.content}],providerOptions:a.providerOptions};return{role:"assistant",content:a.content.filter(a=>"text"!==a.type||""!==a.text).map(a=>{let b=a.providerOptions;switch(a.type){case"file":{let{data:c,mediaType:d}=cC(a.data);return{type:"file",data:c,filename:a.filename,mediaType:null!=d?d:a.mediaType,providerOptions:b}}case"reasoning":return{type:"reasoning",text:a.text,providerOptions:b};case"text":return{type:"text",text:a.text,providerOptions:b};case"tool-call":return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:b};case"tool-result":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:a.output,providerOptions:b}}}),providerOptions:a.providerOptions};case"tool":return{role:"tool",content:a.content.map(a=>({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:a.output,providerOptions:a.providerOptions})),providerOptions:a.providerOptions};default:throw new cG({role:c})}})({message:a,downloadedAssets:d}))]}async function cI(a,b,c){let d=a.filter(a=>"user"===a.role).map(a=>a.content).filter(a=>Array.isArray(a)).flat().filter(a=>"image"===a.type||"file"===a.type).map(a=>{var b;let c=null!=(b=a.mediaType)?b:"image"===a.type?"image/*":void 0,d="image"===a.type?a.image:a.data;if("string"==typeof d)try{d=new URL(d)}catch(a){}return{mediaType:c,data:d}}).filter(a=>a.data instanceof URL&&null!=a.mediaType&&!function({mediaType:a,url:b,supportedUrls:c}){return b=b.toLowerCase(),a=a.toLowerCase(),Object.entries(c).map(([a,b])=>{let c=a.toLowerCase();return"*"===c||"*/*"===c?{mediaTypePrefix:"",regexes:b}:{mediaTypePrefix:c.replace(/\*/,""),regexes:b}}).filter(({mediaTypePrefix:b})=>a.startsWith(b)).flatMap(({regexes:a})=>a).some(a=>a.test(b))}({url:a.data.toString(),mediaType:a.mediaType,supportedUrls:c})).map(a=>a.data);return Object.fromEntries((await Promise.all(d.map(async a=>({url:a,data:await b({url:a})})))).map(({url:a,data:b})=>[a.toString(),b]))}F=cF,Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");var cJ="AI_InvalidToolInputError",cK=`vercel.ai.error.${cJ}`,cL=Symbol.for(cK),cM=class extends ac{constructor({toolInput:a,toolName:b,cause:c,message:d=`Invalid input for tool ${b}: ${al(c)}`}){super({name:cJ,message:d,cause:c}),this[G]=!0,this.toolInput=a,this.toolName=b}static isInstance(a){return ac.hasMarker(a,cK)}};G=cL,Symbol.for("vercel.ai.error.AI_MCPClientError"),Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var cN="AI_NoObjectGeneratedError",cO=`vercel.ai.error.${cN}`,cP=Symbol.for(cO),cQ=class extends ac{constructor({message:a="No object generated.",cause:b,text:c,response:d,usage:e,finishReason:f}){super({name:cN,message:a,cause:b}),this[H]=!0,this.text=c,this.response=d,this.usage=e,this.finishReason=f}static isInstance(a){return ac.hasMarker(a,cO)}};H=cP;var cR="AI_NoSuchToolError",cS=`vercel.ai.error.${cR}`,cT=Symbol.for(cS),cU=class extends ac{constructor({toolName:a,availableTools:b,message:c=`Model tried to call unavailable tool '${a}'. ${void 0===b?"No tools are available.":`Available tools: ${b.join(", ")}.`}`}){super({name:cR,message:c}),this[I]=!0,this.toolName=a,this.availableTools=b}static isInstance(a){return ac.hasMarker(a,cS)}};I=cT;var cV="AI_ToolCallRepairError",cW=`vercel.ai.error.${cV}`,cX=Symbol.for(cW),cY=class extends ac{constructor({cause:a,originalError:b,message:c=`Error repairing tool call: ${al(a)}`}){super({name:cV,message:c,cause:a}),this[J]=!0,this.originalError=b}static isInstance(a){return ac.hasMarker(a,cW)}};J=cX;var cZ=class extends ac{constructor(a){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${a.version} for provider "${a.provider}" and model "${a.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=a.version,this.provider=a.provider,this.modelId=a.modelId}};function c$(a){if("string"!=typeof a){if("v2"!==a.specificationVersion)throw new cZ({version:a.specificationVersion,provider:a.provider,modelId:a.modelId});return a}let b=globalThis.AI_SDK_DEFAULT_PROVIDER;return(null!=b?b:cc).languageModel(a)}Symbol.for("vercel.ai.error.AI_MessageConversionError");var c_=bC.RZ(()=>bC.KC([bC.ch(),bC.Yj(),bC.ai(),bC.zM(),bC.g1(bC.Yj(),c_),bC.YO(c_)])),c0=bC.g1(bC.Yj(),bC.g1(bC.Yj(),c_)),c1=bC.Ik({type:bC.eu("text"),text:bC.Yj(),providerOptions:c0.optional()}),c2=bC.Ik({type:bC.eu("image"),image:bC.KC([cB,bC.Nl(URL)]),mediaType:bC.Yj().optional(),providerOptions:c0.optional()}),c3=bC.Ik({type:bC.eu("file"),data:bC.KC([cB,bC.Nl(URL)]),filename:bC.Yj().optional(),mediaType:bC.Yj(),providerOptions:c0.optional()}),c4=bC.Ik({type:bC.eu("reasoning"),text:bC.Yj(),providerOptions:c0.optional()}),c5=bC.Ik({type:bC.eu("tool-call"),toolCallId:bC.Yj(),toolName:bC.Yj(),input:bC.L5(),providerOptions:c0.optional(),providerExecuted:bC.zM().optional()}),c6=bC.gM("type",[bC.Ik({type:bC.eu("text"),value:bC.Yj()}),bC.Ik({type:bC.eu("json"),value:c_}),bC.Ik({type:bC.eu("error-text"),value:bC.Yj()}),bC.Ik({type:bC.eu("error-json"),value:c_}),bC.Ik({type:bC.eu("content"),value:bC.YO(bC.KC([bC.Ik({type:bC.eu("text"),text:bC.Yj()}),bC.Ik({type:bC.eu("media"),data:bC.Yj(),mediaType:bC.Yj()})]))})]),c7=bC.Ik({type:bC.eu("tool-result"),toolCallId:bC.Yj(),toolName:bC.Yj(),output:c6,providerOptions:c0.optional()}),c8=bC.Ik({role:bC.eu("system"),content:bC.Yj(),providerOptions:c0.optional()}),c9=bC.Ik({role:bC.eu("user"),content:bC.KC([bC.Yj(),bC.YO(bC.KC([c1,c2,c3]))]),providerOptions:c0.optional()}),da=bC.Ik({role:bC.eu("assistant"),content:bC.KC([bC.Yj(),bC.YO(bC.KC([c1,c3,c4,c5,c7]))]),providerOptions:c0.optional()}),db=bC.Ik({role:bC.eu("tool"),content:bC.YO(c7),providerOptions:c0.optional()}),dc=bC.KC([c8,c9,da,db]);async function dd(a){let b;if(null==a.prompt&&null==a.messages)throw new at({prompt:a,message:"prompt or messages must be defined"});if(null!=a.prompt&&null!=a.messages)throw new at({prompt:a,message:"prompt and messages cannot be defined at the same time"});if(null!=a.system&&"string"!=typeof a.system)throw new at({prompt:a,message:"system must be a string"});if(null!=a.prompt&&"string"==typeof a.prompt)b=[{role:"user",content:a.prompt}];else if(null!=a.prompt&&Array.isArray(a.prompt))b=a.prompt;else if(null!=a.messages)b=a.messages;else throw new at({prompt:a,message:"prompt or messages must be defined"});if(0===b.length)throw new at({prompt:a,message:"messages must not be empty"});let c=await bm({value:b,schema:bC.YO(dc)});if(!c.success)throw new at({prompt:a,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:c.error});return{messages:b,system:a.system}}function de({operationId:a,telemetry:b}){return{"operation.name":`${a}${(null==b?void 0:b.functionId)!=null?` ${b.functionId}`:""}`,"resource.name":null==b?void 0:b.functionId,"ai.operationId":a,"ai.telemetry.functionId":null==b?void 0:b.functionId}}var df={startSpan:()=>dg,startActiveSpan:(a,b,c,d)=>"function"==typeof b?b(dg):"function"==typeof c?c(dg):"function"==typeof d?d(dg):void 0},dg={spanContext:()=>dh,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},dh={traceId:"",spanId:"",traceFlags:0};function di({name:a,tracer:b,attributes:c,fn:d,endWhenDone:e=!0}){return b.startActiveSpan(a,{attributes:c},async a=>{try{let b=await d(a);return e&&a.end(),b}catch(b){try{dj(a,b)}finally{a.end()}throw b}})}function dj(a,b){b instanceof Error?(a.recordException({name:b.name,message:b.message,stack:b.stack}),a.setStatus({code:cf.s.ERROR,message:b.message})):a.setStatus({code:cf.s.ERROR})}function dk({telemetry:a,attributes:b}){return(null==a?void 0:a.isEnabled)!==!0?{}:Object.entries(b).reduce((b,[c,d])=>{if(null==d)return b;if("object"==typeof d&&"input"in d&&"function"==typeof d.input){if((null==a?void 0:a.recordInputs)===!1)return b;let e=d.input();return null==e?b:{...b,[c]:e}}if("object"==typeof d&&"output"in d&&"function"==typeof d.output){if((null==a?void 0:a.recordOutputs)===!1)return b;let e=d.output();return null==e?b:{...b,[c]:e}}return{...b,[c]:d}},{})}function dl(a,b){return null==a&&null==b?void 0:(null!=a?a:0)+(null!=b?b:0)}var dm=class{constructor({data:a,mediaType:b}){let c=a instanceof Uint8Array;this.base64Data=c?void 0:a,this.uint8ArrayData=c?a:void 0,this.mediaType=b}get base64(){return null==this.base64Data&&(this.base64Data=bB(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=bA(this.base64Data)),this.uint8ArrayData}},dn=class extends dm{constructor(a){super(a),this.type="file"}};async function dp({toolCall:a,tools:b,repairToolCall:c,system:d,messages:e}){if(null==b)throw new cU({toolName:a.toolName});try{return await dq({toolCall:a,tools:b})}catch(g){if(null==c||!(cU.isInstance(g)||cM.isInstance(g)))throw g;let f=null;try{f=await c({toolCall:a,tools:b,inputSchema:({toolName:a})=>{let{inputSchema:c}=b[a];return bx(c).jsonSchema},system:d,messages:e,error:g})}catch(a){throw new cY({cause:a,originalError:g})}if(null==f)throw g;return await dq({toolCall:f,tools:b})}}async function dq({toolCall:a,tools:b}){let c=a.toolName,d=b[c];if(null==d)throw new cU({toolName:a.toolName,availableTools:Object.keys(b)});let e=bx(d.inputSchema),f=""===a.input.trim()?await bm({value:{},schema:e}):await bo({text:a.input,schema:e});if(!1===f.success)throw new cM({toolName:c,toolInput:a.input,cause:f.error});return{type:"tool-call",toolCallId:a.toolCallId,toolName:c,input:f.value,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}}var dr=class{constructor({content:a,finishReason:b,usage:c,warnings:d,request:e,response:f,providerMetadata:g}){this.content=a,this.finishReason=b,this.usage=c,this.warnings=d,this.request=e,this.response=f,this.providerMetadata=g}get text(){return this.content.filter(a=>"text"===a.type).map(a=>a.text).join("")}get reasoning(){return this.content.filter(a=>"reasoning"===a.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(a=>a.text).join("")}get files(){return this.content.filter(a=>"file"===a.type).map(a=>a.file)}get sources(){return this.content.filter(a=>"source"===a.type)}get toolCalls(){return this.content.filter(a=>"tool-call"===a.type)}get toolResults(){return this.content.filter(a=>"tool-result"===a.type)}};async function ds({stopConditions:a,steps:b}){return(await Promise.all(a.map(a=>a({steps:b})))).some(a=>a)}function dt({output:a,tool:b,errorMode:c}){return"text"===c?{type:"error-text",value:al(a)}:"json"===c?{type:"error-json",value:a}:(null==b?void 0:b.toModelOutput)?b.toModelOutput(a):"string"==typeof a?{type:"text",value:a}:{type:"json",value:a}}function du({content:a,tools:b}){let c=[],d=a.filter(a=>"source"!==a.type).filter(a=>("tool-result"!==a.type||a.providerExecuted)&&("tool-error"!==a.type||a.providerExecuted)).filter(a=>"text"!==a.type||a.text.length>0).map(a=>{switch(a.type){case"text":return{type:"text",text:a.text,providerOptions:a.providerMetadata};case"reasoning":return{type:"reasoning",text:a.text,providerOptions:a.providerMetadata};case"file":return{type:"file",data:a.file.base64,mediaType:a.file.mediaType,providerOptions:a.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:a.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:dt({tool:null==b?void 0:b[a.toolName],output:a.output,errorMode:"none"}),providerExecuted:!0,providerOptions:a.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:dt({tool:null==b?void 0:b[a.toolName],output:a.error,errorMode:"json"}),providerOptions:a.providerMetadata}}});d.length>0&&c.push({role:"assistant",content:d});let e=a.filter(a=>"tool-result"===a.type||"tool-error"===a.type).filter(a=>!a.providerExecuted).map(a=>({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:dt({tool:null==b?void 0:b[a.toolName],output:"tool-result"===a.type?a.output:a.error,errorMode:"tool-error"===a.type?"text":"none"})}));return e.length>0&&c.push({role:"tool",content:e}),c}function dv(a,b){let c=new Headers(null!=a?a:{});for(let[a,d]of Object.entries(b))c.has(a)||c.set(a,d);return c}function dw({response:a,status:b,statusText:c,headers:d,stream:e}){a.writeHead(null!=b?b:200,c,d);let f=e.getReader();(async()=>{try{for(;;){let{done:b,value:c}=await f.read();if(b)break;a.write(c)}}catch(a){throw a}finally{a.end()}})()}a8({prefix:"aitxt",size:24});var dx=class extends TransformStream{constructor(){super({transform(a,b){b.enqueue(`data: ${JSON.stringify(a)}

`)},flush(a){a.enqueue("data: [DONE]\n\n")}})}},dy={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};async function dz(a){if(void 0===a)return{value:void 0,state:"undefined-input"};let b=await bo({text:a});return b.success?{value:b.value,state:"successful-parse"}:(b=await bo({text:function(a){let b=["ROOT"],c=-1,d=null;function e(a,e,f){switch(a){case'"':c=e,b.pop(),b.push(f),b.push("INSIDE_STRING");break;case"f":case"t":case"n":c=e,d=e,b.pop(),b.push(f),b.push("INSIDE_LITERAL");break;case"-":b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=e,b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"{":c=e,b.pop(),b.push(f),b.push("INSIDE_OBJECT_START");break;case"[":c=e,b.pop(),b.push(f),b.push("INSIDE_ARRAY_START")}}function f(a,d){switch(a){case",":b.pop(),b.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":c=d,b.pop()}}function g(a,d){switch(a){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=d,b.pop()}}for(let h=0;h<a.length;h++){let i=a[h];switch(b[b.length-1]){case"ROOT":e(i,h,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':b.pop(),b.push("INSIDE_OBJECT_KEY");break;case"}":c=h,b.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(b.pop(),b.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":e(i,h,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":f(i,h);break;case"INSIDE_STRING":switch(i){case'"':b.pop(),c=h;break;case"\\":b.push("INSIDE_STRING_ESCAPE");break;default:c=h}break;case"INSIDE_ARRAY_START":"]"===i?(c=h,b.pop()):(c=h,e(i,h,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=h,b.pop();break;default:c=h}break;case"INSIDE_ARRAY_AFTER_COMMA":e(i,h,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":b.pop(),c=h;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=h;break;case"e":case"E":case"-":case".":break;case",":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"}":b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"]":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h);break;default:b.pop()}break;case"INSIDE_LITERAL":{let e=a.substring(d,h+1);"false".startsWith(e)||"true".startsWith(e)||"null".startsWith(e)?c=h:(b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]?f(i,h):"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h))}}}let h=a.slice(0,c+1);for(let c=b.length-1;c>=0;c--)switch(b[c]){case"INSIDE_STRING":h+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":h+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":h+="]";break;case"INSIDE_LITERAL":{let b=a.substring(d,a.length);"true".startsWith(b)?h+="true".slice(b.length):"false".startsWith(b)?h+="false".slice(b.length):"null".startsWith(b)&&(h+="null".slice(b.length))}}return h}(a)})).success?{value:b.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function dA(a){return a.type.startsWith("tool-")}function dB(a){return a.type.split("-").slice(1).join("-")}function dC(a){let b=a.pipeThrough(new TransformStream);return b[Symbol.asyncIterator]=()=>{let a=b.getReader();return{async next(){let{done:b,value:c}=await a.read();return b?{done:!0,value:void 0}:{done:!1,value:c}}}},b}async function dD({stream:a,onError:b}){let c=a.getReader();try{for(;;){let{done:a}=await c.read();if(a)break}}catch(a){null==b||b(a)}finally{c.releaseLock()}}function dE(){let a,b;return{promise:new Promise((c,d)=>{a=c,b=d}),resolve:a,reject:b}}bC.KC([bC.re({type:bC.eu("text-start"),id:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("text-delta"),id:bC.Yj(),delta:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("text-end"),id:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("error"),errorText:bC.Yj()}),bC.re({type:bC.eu("tool-input-start"),toolCallId:bC.Yj(),toolName:bC.Yj(),providerExecuted:bC.zM().optional()}),bC.re({type:bC.eu("tool-input-delta"),toolCallId:bC.Yj(),inputTextDelta:bC.Yj()}),bC.re({type:bC.eu("tool-input-available"),toolCallId:bC.Yj(),toolName:bC.Yj(),input:bC.L5(),providerExecuted:bC.zM().optional(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("tool-output-available"),toolCallId:bC.Yj(),output:bC.L5(),providerExecuted:bC.zM().optional()}),bC.re({type:bC.eu("tool-output-error"),toolCallId:bC.Yj(),errorText:bC.Yj(),providerExecuted:bC.zM().optional()}),bC.re({type:bC.eu("reasoning"),text:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("reasoning-start"),id:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("reasoning-delta"),id:bC.Yj(),delta:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("reasoning-end"),id:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("reasoning-part-finish")}),bC.re({type:bC.eu("source-url"),sourceId:bC.Yj(),url:bC.Yj(),title:bC.Yj().optional(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("source-document"),sourceId:bC.Yj(),mediaType:bC.Yj(),title:bC.Yj(),filename:bC.Yj().optional(),providerMetadata:c0.optional()}),bC.re({type:bC.eu("file"),url:bC.Yj(),mediaType:bC.Yj(),providerMetadata:c0.optional()}),bC.re({type:bC.Yj().startsWith("data-"),id:bC.Yj().optional(),data:bC.L5(),transient:bC.zM().optional()}),bC.re({type:bC.eu("start-step")}),bC.re({type:bC.eu("finish-step")}),bC.re({type:bC.eu("start"),messageId:bC.Yj().optional(),messageMetadata:bC.L5().optional()}),bC.re({type:bC.eu("finish"),messageMetadata:bC.L5().optional()}),bC.re({type:bC.eu("abort")}),bC.re({type:bC.eu("message-metadata"),messageMetadata:bC.L5()})]);var dF=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((a,b)=>{"resolved"===this.status.type?a(this.status.value):"rejected"===this.status.type&&b(this.status.error),this._resolve=a,this._reject=b})),this._promise}resolve(a){var b;this.status={type:"resolved",value:a},this._promise&&(null==(b=this._resolve)||b.call(this,a))}reject(a){var b;this.status={type:"rejected",error:a},this._promise&&(null==(b=this._reject)||b.call(this,a))}},dG=a8({prefix:"aitxt",size:24}),dH=class{constructor({model:a,telemetry:b,headers:c,settings:d,maxRetries:e,abortSignal:f,system:g,prompt:h,messages:i,tools:j,toolChoice:k,transforms:l,activeTools:m,repairToolCall:n,stopConditions:o,output:p,providerOptions:q,prepareStep:r,includeRawChunks:s,now:t,currentDate:u,generateId:v,onChunk:w,onError:x,onFinish:y,onAbort:z,onStepFinish:A}){let B,C,D,E;this._totalUsage=new dF,this._finishReason=new dF,this._steps=new dF,this.output=p,this.includeRawChunks=s;let F=[],G=[],H={},I=[],J=[],K={},L={},M=new TransformStream({async transform(a,b){var c,d,e,f;b.enqueue(a);let{part:g}=a;if(("text"===g.type||"reasoning"===g.type||"source"===g.type||"tool-call"===g.type||"tool-result"===g.type||"tool-input-start"===g.type||"tool-input-delta"===g.type||"raw"===g.type)&&await (null==w?void 0:w({chunk:g})),"error"===g.type&&await x({error:(f=g.error,bH.isInstance(f)||bR.isInstance(f)?new ac({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:f}):f)}),"text-start"===g.type&&(K[g.id]={type:"text",text:"",providerMetadata:g.providerMetadata},F.push(K[g.id])),"text"===g.type){let a=K[g.id];if(null==a)return void b.enqueue({part:{type:"error",error:`text part ${g.id} not found`},partialOutput:void 0});a.text+=g.text,a.providerMetadata=null!=(c=g.providerMetadata)?c:a.providerMetadata}if("text-end"===g.type&&delete K[g.id],"reasoning-start"===g.type&&(L[g.id]={type:"reasoning",text:"",providerMetadata:g.providerMetadata},F.push(L[g.id])),"reasoning"===g.type){let a=L[g.id];if(null==a)return void b.enqueue({part:{type:"error",error:`reasoning part ${g.id} not found`},partialOutput:void 0});a.text+=g.text,a.providerMetadata=null!=(d=g.providerMetadata)?d:a.providerMetadata}if("reasoning-end"===g.type){let a=L[g.id];if(null==a)return void b.enqueue({part:{type:"error",error:`reasoning part ${g.id} not found`},partialOutput:void 0});a.providerMetadata=null!=(e=g.providerMetadata)?e:a.providerMetadata,delete L[g.id]}if("file"===g.type&&F.push({type:"file",file:g.file}),"source"===g.type&&F.push(g),"tool-call"===g.type&&F.push(g),"tool-result"===g.type&&F.push(g),"tool-error"===g.type&&F.push(g),"start-step"===g.type&&(H=g.request,I=g.warnings),"finish-step"===g.type){let a=du({content:F,tools:j}),b=new dr({content:F,finishReason:g.finishReason,usage:g.usage,warnings:I,request:H,response:{...g.response,messages:[...G,...a]},providerMetadata:g.providerMetadata});await (null==A?void 0:A(b)),J.push(b),F=[],L={},K={},G.push(...a),B.resolve()}"finish"===g.type&&(E=g.totalUsage,D=g.finishReason)},async flush(a){try{if(0===J.length)return;let a=null!=D?D:"unknown",c=null!=E?E:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};U._finishReason.resolve(a),U._totalUsage.resolve(c),U._steps.resolve(J);let d=J[J.length-1];await (null==y?void 0:y({finishReason:a,totalUsage:c,usage:d.usage,content:d.content,text:d.text,reasoningText:d.reasoningText,reasoning:d.reasoning,files:d.files,sources:d.sources,toolCalls:d.toolCalls,toolResults:d.toolResults,request:d.request,response:d.response,warnings:d.warnings,providerMetadata:d.providerMetadata,steps:J})),C.setAttributes(dk({telemetry:b,attributes:{"ai.response.finishReason":a,"ai.response.text":{output:()=>d.text},"ai.response.toolCalls":{output:()=>{var a;return(null==(a=d.toolCalls)?void 0:a.length)?JSON.stringify(d.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(d.providerMetadata),"ai.usage.inputTokens":c.inputTokens,"ai.usage.outputTokens":c.outputTokens,"ai.usage.totalTokens":c.totalTokens,"ai.usage.reasoningTokens":c.reasoningTokens,"ai.usage.cachedInputTokens":c.cachedInputTokens}}))}catch(b){a.error(b)}finally{C.end()}}}),N=function(){let a=[],b=null,c=!1,d=dE(),e=()=>{c=!0,d.resolve(),a.forEach(a=>a.cancel()),a=[],null==b||b.close()},f=async()=>{if(c&&0===a.length){null==b||b.close();return}if(0===a.length)return d=dE(),await d.promise,f();try{let{value:d,done:e}=await a[0].read();e?(a.shift(),a.length>0?await f():c&&(null==b||b.close())):null==b||b.enqueue(d)}catch(c){null==b||b.error(c),a.shift(),e()}};return{stream:new ReadableStream({start(a){b=a},pull:f,async cancel(){for(let b of a)await b.cancel();a=[],c=!0}}),addStream:b=>{if(c)throw Error("Cannot add inner stream: outer stream is closed");a.push(b.getReader()),d.resolve()},close:()=>{c=!0,d.resolve(),0===a.length&&(null==b||b.close())},terminate:e}}();this.addStream=N.addStream,this.closeStream=N.close;let O=N.stream;for(let a of(O=(O=function(a,b){return new ReadableStream({async start(c){let d=a.getReader();try{for(;;){let{done:a,value:b}=await d.read();if(a){c.close();break}c.enqueue(b)}}catch(a){await b({error:a,controller:c})}},cancel:b=>a.cancel(b)})}(O,({error:a,controller:b})=>{ba(a)&&(null==f?void 0:f.aborted)?(null==z||z({steps:J}),b.enqueue({type:"abort"}),b.close()):b.error(a)})).pipeThrough(new TransformStream({start(a){a.enqueue({type:"start"})}})),l))O=O.pipeThrough(a({tools:j,stopStream(){N.terminate()}}));this.baseStream=O.pipeThrough(function(a){let b;if(!a)return new TransformStream({transform(a,b){b.enqueue({part:a,partialOutput:void 0})}});let c="",d="",e="";function f({controller:a,partialOutput:c}){a.enqueue({part:{type:"text",id:b,text:d},partialOutput:c}),d=""}return new TransformStream({async transform(g,h){if("finish-step"===g.type&&d.length>0&&f({controller:h}),"text"!==g.type&&"text-start"!==g.type&&"text-end"!==g.type)return void h.enqueue({part:g,partialOutput:void 0});if(null==b)b=g.id;else if(g.id!==b)return void h.enqueue({part:g,partialOutput:void 0});if("text-start"===g.type)return void h.enqueue({part:g,partialOutput:void 0});if("text-end"===g.type){d.length>0&&f({controller:h}),h.enqueue({part:g,partialOutput:void 0});return}c+=g.text,d+=g.text;let i=await a.parsePartial({text:c});if(null!=i){let a=JSON.stringify(i.partial);a!==e&&(f({controller:h,partialOutput:i.partial}),e=a)}}})}(p)).pipeThrough(M);let{maxRetries:P,retry:Q}=function({maxRetries:a}){if(null!=a){if(!Number.isInteger(a))throw new cp({parameter:"maxRetries",value:a,message:"maxRetries must be an integer"});if(a<0)throw new cp({parameter:"maxRetries",value:a,message:"maxRetries must be >= 0"})}let b=null!=a?a:2;return{maxRetries:b,retry:(({maxRetries:a=2,initialDelayInMs:b=2e3,backoffFactor:c=2}={})=>async d=>cu(d,{maxRetries:a,delayInMs:b,backoffFactor:c}))({maxRetries:b})}}({maxRetries:e}),R=function({isEnabled:a=!1,tracer:b}={}){return a?b||ce.u.getTracer("ai"):df}(b),S=function({maxOutputTokens:a,temperature:b,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,seed:g,stopSequences:h}){if(null!=a){if(!Number.isInteger(a))throw new cp({parameter:"maxOutputTokens",value:a,message:"maxOutputTokens must be an integer"});if(a<1)throw new cp({parameter:"maxOutputTokens",value:a,message:"maxOutputTokens must be >= 1"})}if(null!=b&&"number"!=typeof b)throw new cp({parameter:"temperature",value:b,message:"temperature must be a number"});if(null!=c&&"number"!=typeof c)throw new cp({parameter:"topP",value:c,message:"topP must be a number"});if(null!=d&&"number"!=typeof d)throw new cp({parameter:"topK",value:d,message:"topK must be a number"});if(null!=e&&"number"!=typeof e)throw new cp({parameter:"presencePenalty",value:e,message:"presencePenalty must be a number"});if(null!=f&&"number"!=typeof f)throw new cp({parameter:"frequencyPenalty",value:f,message:"frequencyPenalty must be a number"});if(null!=g&&!Number.isInteger(g))throw new cp({parameter:"seed",value:g,message:"seed must be an integer"});return{maxOutputTokens:a,temperature:b,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,stopSequences:h,seed:g}}(d),T=function({model:a,settings:b,telemetry:c,headers:d}){var e;return{"ai.model.provider":a.provider,"ai.model.id":a.modelId,...Object.entries(b).reduce((a,[b,c])=>(a[`ai.settings.${b}`]=c,a),{}),...Object.entries(null!=(e=null==c?void 0:c.metadata)?e:{}).reduce((a,[b,c])=>(a[`ai.telemetry.metadata.${b}`]=c,a),{}),...Object.entries(null!=d?d:{}).reduce((a,[b,c])=>(void 0!==c&&(a[`ai.request.headers.${b}`]=c),a),{})}}({model:a,telemetry:b,headers:c,settings:{...S,maxRetries:P}}),U=this;di({name:"ai.streamText",attributes:dk({telemetry:b,attributes:{...de({operationId:"ai.streamText",telemetry:b}),...T,"ai.prompt":{input:()=>JSON.stringify({system:g,prompt:h,messages:i})}}}),tracer:R,endWhenDone:!1,fn:async d=>{async function e({currentStep:d,responseMessages:l,usage:s}){var w,x,y,z,A;let C,D,E=U.includeRawChunks;B=new dF;let F=await dd({system:g,prompt:h,messages:i}),G=[...F.messages,...l],H=await (null==r?void 0:r({model:a,steps:J,stepNumber:J.length,messages:G})),I=await cH({prompt:{system:null!=(w=null==H?void 0:H.system)?w:F.system,messages:null!=(x=null==H?void 0:H.messages)?x:G},supportedUrls:await a.supportedUrls}),K=c$(null!=(y=null==H?void 0:H.model)?y:a),{toolChoice:L,tools:M}=function({tools:a,toolChoice:b,activeTools:c}){return null!=a&&Object.keys(a).length>0?{tools:(null!=c?Object.entries(a).filter(([a])=>c.includes(a)):Object.entries(a)).map(([a,b])=>{let c=b.type;switch(c){case void 0:case"function":return{type:"function",name:a,description:b.description,inputSchema:bx(b.inputSchema).jsonSchema};case"provider-defined":return{type:"provider-defined",name:a,id:b.id,args:b.args};default:throw Error(`Unsupported tool type: ${c}`)}}),toolChoice:null==b?{type:"auto"}:"string"==typeof b?{type:b}:{type:"tool",toolName:b.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:j,toolChoice:null!=(z=null==H?void 0:H.toolChoice)?z:k,activeTools:null!=(A=null==H?void 0:H.activeTools)?A:m}),{result:{stream:N,response:O,request:P},doStreamSpan:V,startTimestampMs:W}=await Q(()=>di({name:"ai.streamText.doStream",attributes:dk({telemetry:b,attributes:{...de({operationId:"ai.streamText.doStream",telemetry:b}),...T,"ai.model.provider":K.provider,"ai.model.id":K.modelId,"ai.prompt.messages":{input:()=>JSON.stringify(I.map(a=>({...a,content:"string"==typeof a.content?a.content:a.content.map(a=>{var b;return"file"===a.type?{...a,data:a.data instanceof Uint8Array?"string"==typeof(b=a.data)?b:b instanceof ArrayBuffer?bB(new Uint8Array(b)):bB(b):a.data}:a})})))},"ai.prompt.tools":{input:()=>null==M?void 0:M.map(a=>JSON.stringify(a))},"ai.prompt.toolChoice":{input:()=>null!=L?JSON.stringify(L):void 0},"gen_ai.system":K.provider,"gen_ai.request.model":K.modelId,"gen_ai.request.frequency_penalty":S.frequencyPenalty,"gen_ai.request.max_tokens":S.maxOutputTokens,"gen_ai.request.presence_penalty":S.presencePenalty,"gen_ai.request.stop_sequences":S.stopSequences,"gen_ai.request.temperature":S.temperature,"gen_ai.request.top_k":S.topK,"gen_ai.request.top_p":S.topP}}),tracer:R,endWhenDone:!1,fn:async a=>({startTimestampMs:t(),doStreamSpan:a,result:await K.doStream({...S,tools:M,toolChoice:L,responseFormat:null==p?void 0:p.responseFormat,prompt:I,providerOptions:q,abortSignal:f,headers:c,includeRawChunks:E})})})),X=function({tools:a,generatorStream:b,tracer:c,telemetry:d,system:e,messages:f,abortSignal:g,repairToolCall:h}){let i,j=null,k=new ReadableStream({start(a){j=a}}),l=new Set,m=new Map,n=!1;function o(){n&&0===l.size&&(null!=i&&j.enqueue(i),j.close())}let p=new TransformStream({async transform(b,k){let n=b.type;switch(n){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":k.enqueue(b);break;case"file":k.enqueue({type:"file",file:new dn({data:b.data,mediaType:b.mediaType})});break;case"finish":i={type:"finish",finishReason:b.finishReason,usage:b.usage,providerMetadata:b.providerMetadata};break;case"tool-call":try{let i=await dp({toolCall:b,tools:a,repairToolCall:h,system:e,messages:f});k.enqueue(i);let n=a[i.toolName];if(m.set(i.toolCallId,i.input),null!=n.onInputAvailable&&await n.onInputAvailable({input:i.input,toolCallId:i.toolCallId,messages:f,abortSignal:g}),null!=n.execute&&!0!==i.providerExecuted){let a=a9();l.add(a),di({name:"ai.toolCall",attributes:dk({telemetry:d,attributes:{...de({operationId:"ai.toolCall",telemetry:d}),"ai.toolCall.name":i.toolName,"ai.toolCall.id":i.toolCallId,"ai.toolCall.input":{output:()=>JSON.stringify(i.input)}}}),tracer:c,fn:async b=>{let c;try{c=await n.execute(i.input,{toolCallId:i.toolCallId,messages:f,abortSignal:g})}catch(c){dj(b,c),j.enqueue({...i,type:"tool-error",error:c}),l.delete(a),o();return}j.enqueue({...i,type:"tool-result",output:c}),l.delete(a),o();try{b.setAttributes(dk({telemetry:d,attributes:{"ai.toolCall.output":{output:()=>JSON.stringify(c)}}}))}catch(a){}}})}}catch(a){j.enqueue({type:"error",error:a})}break;case"tool-result":{let a=b.toolName;b.isError?j.enqueue({type:"tool-error",toolCallId:b.toolCallId,toolName:a,input:m.get(b.toolCallId),providerExecuted:b.providerExecuted,error:b.result}):k.enqueue({type:"tool-result",toolCallId:b.toolCallId,toolName:a,input:m.get(b.toolCallId),output:b.result,providerExecuted:b.providerExecuted});break}default:throw Error(`Unhandled chunk type: ${n}`)}},flush(){n=!0,o()}});return new ReadableStream({start:async a=>Promise.all([b.pipeThrough(p).pipeTo(new WritableStream({write(b){a.enqueue(b)},close(){}})),k.pipeTo(new WritableStream({write(b){a.enqueue(b)},close(){a.close()}}))])})}({tools:j,generatorStream:N,tracer:R,telemetry:b,system:g,messages:G,repairToolCall:n,abortSignal:f}),Y=null!=P?P:{},Z=[],$=[],_={},aa="unknown",ab={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},ac=!0,ad={id:v(),timestamp:u(),modelId:a.modelId},ae="";U.addStream(X.pipeThrough(new TransformStream({async transform(a,b){var c,d,e,g;if("stream-start"===a.type){C=a.warnings;return}if(ac){let a=t()-W;ac=!1,V.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":a}),V.setAttributes({"ai.response.msToFirstChunk":a}),b.enqueue({type:"start-step",request:Y,warnings:null!=C?C:[]})}let h=a.type;switch(h){case"text-start":case"text-end":case"reasoning-start":case"reasoning-end":case"file":case"source":b.enqueue(a);break;case"text-delta":a.delta.length>0&&(b.enqueue({type:"text",id:a.id,text:a.delta,providerMetadata:a.providerMetadata}),ae+=a.delta);break;case"reasoning-delta":b.enqueue({type:"reasoning",id:a.id,text:a.delta,providerMetadata:a.providerMetadata});break;case"tool-call":b.enqueue(a),Z.push(a);break;case"tool-result":case"tool-error":b.enqueue(a),$.push(a);break;case"response-metadata":ad={id:null!=(c=a.id)?c:ad.id,timestamp:null!=(d=a.timestamp)?d:ad.timestamp,modelId:null!=(e=a.modelId)?e:ad.modelId};break;case"finish":{ab=a.usage,aa=a.finishReason,D=a.providerMetadata;let b=t()-W;V.addEvent("ai.stream.finish"),V.setAttributes({"ai.response.msToFinish":b,"ai.response.avgOutputTokensPerSecond":1e3*(null!=(g=ab.outputTokens)?g:0)/b});break}case"tool-input-start":{_[a.id]=a.toolName;let c=null==j?void 0:j[a.toolName];(null==c?void 0:c.onInputStart)!=null&&await c.onInputStart({toolCallId:a.id,messages:G,abortSignal:f}),b.enqueue(a);break}case"tool-input-end":delete _[a.id],b.enqueue(a);break;case"tool-input-delta":{let c=_[a.id],d=null==j?void 0:j[c];(null==d?void 0:d.onInputDelta)!=null&&await d.onInputDelta({inputTextDelta:a.delta,toolCallId:a.id,messages:G,abortSignal:f}),b.enqueue(a);break}case"error":b.enqueue(a),aa="error";break;case"raw":E&&b.enqueue(a);break;default:throw Error(`Unknown chunk type: ${h}`)}},async flush(a){var c;let f=Z.length>0?JSON.stringify(Z):void 0;try{V.setAttributes(dk({telemetry:b,attributes:{"ai.response.finishReason":aa,"ai.response.text":{output:()=>ae},"ai.response.toolCalls":{output:()=>f},"ai.response.id":ad.id,"ai.response.model":ad.modelId,"ai.response.timestamp":ad.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(D),"ai.usage.inputTokens":ab.inputTokens,"ai.usage.outputTokens":ab.outputTokens,"ai.usage.totalTokens":ab.totalTokens,"ai.usage.reasoningTokens":ab.reasoningTokens,"ai.usage.cachedInputTokens":ab.cachedInputTokens,"gen_ai.response.finish_reasons":[aa],"gen_ai.response.id":ad.id,"gen_ai.response.model":ad.modelId,"gen_ai.usage.input_tokens":ab.inputTokens,"gen_ai.usage.output_tokens":ab.outputTokens}}))}catch(a){}finally{V.end()}a.enqueue({type:"finish-step",finishReason:aa,usage:ab,providerMetadata:D,response:{...ad,headers:null==O?void 0:O.headers}});let g=(c=ab,{inputTokens:dl(s.inputTokens,c.inputTokens),outputTokens:dl(s.outputTokens,c.outputTokens),totalTokens:dl(s.totalTokens,c.totalTokens),reasoningTokens:dl(s.reasoningTokens,c.reasoningTokens),cachedInputTokens:dl(s.cachedInputTokens,c.cachedInputTokens)});await B.promise;let h=Z.filter(a=>!0!==a.providerExecuted),i=$.filter(a=>!0!==a.providerExecuted);if(h.length>0&&i.length===h.length&&!await ds({stopConditions:o,steps:J})){l.push(...du({content:J[J.length-1].content,tools:j}));try{await e({currentStep:d+1,responseMessages:l,usage:g})}catch(b){a.enqueue({type:"error",error:b}),U.closeStream()}}else a.enqueue({type:"finish",finishReason:aa,totalUsage:g}),U.closeStream()}})))}C=d,await e({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(a=>{U.addStream(new ReadableStream({start(b){b.enqueue({type:"error",error:a}),b.close()}})),U.closeStream()})}get steps(){return this._steps.promise}get finalStep(){return this.steps.then(a=>a[a.length-1])}get content(){return this.finalStep.then(a=>a.content)}get warnings(){return this.finalStep.then(a=>a.warnings)}get providerMetadata(){return this.finalStep.then(a=>a.providerMetadata)}get text(){return this.finalStep.then(a=>a.text)}get reasoningText(){return this.finalStep.then(a=>a.reasoningText)}get reasoning(){return this.finalStep.then(a=>a.reasoning)}get sources(){return this.finalStep.then(a=>a.sources)}get files(){return this.finalStep.then(a=>a.files)}get toolCalls(){return this.finalStep.then(a=>a.toolCalls)}get toolResults(){return this.finalStep.then(a=>a.toolResults)}get usage(){return this.finalStep.then(a=>a.usage)}get request(){return this.finalStep.then(a=>a.request)}get response(){return this.finalStep.then(a=>a.response)}get totalUsage(){return this._totalUsage.promise}get finishReason(){return this._finishReason.promise}teeStream(){let[a,b]=this.baseStream.tee();return this.baseStream=b,a}get textStream(){return dC(this.teeStream().pipeThrough(new TransformStream({transform({part:a},b){"text"===a.type&&b.enqueue(a.text)}})))}get fullStream(){return dC(this.teeStream().pipeThrough(new TransformStream({transform({part:a},b){b.enqueue(a)}})))}async consumeStream(a){var b;try{await dD({stream:this.fullStream,onError:null==a?void 0:a.onError})}catch(c){null==(b=null==a?void 0:a.onError)||b.call(a,c)}}get experimental_partialOutputStream(){if(null==this.output)throw new ck;return dC(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:a},b){null!=a&&b.enqueue(a)}})))}toUIMessageStream({originalMessages:a,generateMessageId:b,onFinish:c,messageMetadata:d,sendReasoning:e=!0,sendSources:f=!1,sendStart:g=!0,sendFinish:h=!0,onError:i=al}={}){let j=null!=b?function({originalMessages:a,responseMessageId:b}){if(null==a)return;let c=a[a.length-1];return(null==c?void 0:c.role)==="assistant"?c.id:"function"==typeof b?b():b}({originalMessages:a,responseMessageId:b}):void 0;return dC(function({messageId:a,originalMessages:b=[],onFinish:c,onError:d,stream:e}){let f=null==b?void 0:b[b.length-1];(null==f?void 0:f.role)!=="assistant"?f=void 0:a=f.id;let g=!1,h=e.pipeThrough(new TransformStream({transform(b,c){"start"===b.type&&null==b.messageId&&null!=a&&(b.messageId=a),"abort"===b.type&&(g=!0),c.enqueue(b)}}));if(null==c)return h;let i=function({lastMessage:a,messageId:b}){return{message:(null==a?void 0:a.role)==="assistant"?a:{id:b,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:f?structuredClone(f):void 0,messageId:null!=a?a:""});return(function({stream:a,onToolCall:b,messageMetadataSchema:c,dataPartSchemas:d,runUpdateMessageJob:e,onError:f,onData:g}){return a.pipeThrough(new TransformStream({async transform(a,h){await e(async({state:e,write:i})=>{var j,k,l,m;function n(a){var b;let c=e.message.parts.find(b=>dA(b)&&b.toolCallId===a.toolCallId);null!=c?(c.state=a.state,c.input=a.input,c.output=a.output,c.errorText=a.errorText,c.providerExecuted=null!=(b=a.providerExecuted)?b:c.providerExecuted,null!=a.providerMetadata&&"input-available"===c.state&&(c.callProviderMetadata=a.providerMetadata)):e.message.parts.push({type:`tool-${a.toolName}`,toolCallId:a.toolCallId,state:a.state,input:a.input,output:a.output,errorText:a.errorText,providerExecuted:a.providerExecuted,...null!=a.providerMetadata?{callProviderMetadata:a.providerMetadata}:{}})}async function o(a){if(null!=a){let b=null!=e.message.metadata?function a(b,c){if(void 0===b&&void 0===c)return;if(void 0===b)return c;if(void 0===c)return b;let d={...b};for(let e in c)if(Object.prototype.hasOwnProperty.call(c,e)){let f=c[e];if(void 0===f)continue;let g=e in b?b[e]:void 0,h=null!==f&&"object"==typeof f&&!Array.isArray(f)&&!(f instanceof Date)&&!(f instanceof RegExp),i=null!=g&&"object"==typeof g&&!Array.isArray(g)&&!(g instanceof Date)&&!(g instanceof RegExp);h&&i?d[e]=a(g,f):d[e]=f}return d}(e.message.metadata,a):a;null!=c&&await bl({value:b,schema:c}),e.message.metadata=b}}switch(a.type){case"text-start":{let b={type:"text",text:"",providerMetadata:a.providerMetadata,state:"streaming"};e.activeTextParts[a.id]=b,e.message.parts.push(b),i();break}case"text-delta":{let b=e.activeTextParts[a.id];b.text+=a.delta,b.providerMetadata=null!=(j=a.providerMetadata)?j:b.providerMetadata,i();break}case"text-end":{let b=e.activeTextParts[a.id];b.state="done",b.providerMetadata=null!=(k=a.providerMetadata)?k:b.providerMetadata,delete e.activeTextParts[a.id],i();break}case"reasoning-start":{let b={type:"reasoning",text:"",providerMetadata:a.providerMetadata,state:"streaming"};e.activeReasoningParts[a.id]=b,e.message.parts.push(b),i();break}case"reasoning-delta":{let b=e.activeReasoningParts[a.id];b.text+=a.delta,b.providerMetadata=null!=(l=a.providerMetadata)?l:b.providerMetadata,i();break}case"reasoning-end":{let b=e.activeReasoningParts[a.id];b.providerMetadata=null!=(m=a.providerMetadata)?m:b.providerMetadata,b.state="done",delete e.activeReasoningParts[a.id],i();break}case"file":e.message.parts.push({type:"file",mediaType:a.mediaType,url:a.url}),i();break;case"source-url":e.message.parts.push({type:"source-url",sourceId:a.sourceId,url:a.url,title:a.title,providerMetadata:a.providerMetadata}),i();break;case"source-document":e.message.parts.push({type:"source-document",sourceId:a.sourceId,mediaType:a.mediaType,title:a.title,filename:a.filename,providerMetadata:a.providerMetadata}),i();break;case"tool-input-start":{let b=e.message.parts.filter(dA);e.partialToolCalls[a.toolCallId]={text:"",toolName:a.toolName,index:b.length},n({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-streaming",input:void 0,providerExecuted:a.providerExecuted}),i();break}case"tool-input-delta":{let b=e.partialToolCalls[a.toolCallId];b.text+=a.inputTextDelta;let{value:c}=await dz(b.text);n({toolCallId:a.toolCallId,toolName:b.toolName,state:"input-streaming",input:c}),i();break}case"tool-input-available":if(n({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-available",input:a.input,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}),i(),b&&!a.providerExecuted){let c=await b({toolCall:a});null!=c&&(n({toolCallId:a.toolCallId,toolName:a.toolName,state:"output-available",input:a.input,output:c}),i())}break;case"tool-output-available":{let b=e.message.parts.filter(dA);if(null==b)throw Error("tool_result must be preceded by a tool_call");let c=b.findIndex(b=>b.toolCallId===a.toolCallId);if(-1===c)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");let d=dB(b[c]);n({toolCallId:a.toolCallId,toolName:d,state:"output-available",input:b[c].input,output:a.output,providerExecuted:a.providerExecuted}),i();break}case"tool-output-error":{let b=e.message.parts.filter(dA);if(null==b)throw Error("tool_result must be preceded by a tool_call");let c=b.findIndex(b=>b.toolCallId===a.toolCallId);if(-1===c)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");let d=dB(b[c]);n({toolCallId:a.toolCallId,toolName:d,state:"output-error",input:b[c].input,errorText:a.errorText,providerExecuted:a.providerExecuted}),i();break}case"start-step":e.message.parts.push({type:"step-start"});break;case"finish-step":e.activeTextParts={},e.activeReasoningParts={};break;case"start":null!=a.messageId&&(e.message.id=a.messageId),await o(a.messageMetadata),(null!=a.messageId||null!=a.messageMetadata)&&i();break;case"finish":case"message-metadata":await o(a.messageMetadata),null!=a.messageMetadata&&i();break;case"error":null==f||f(Error(a.errorText));break;default:if(a.type.startsWith("data-")){if((null==d?void 0:d[a.type])!=null&&await bl({value:a.data,schema:d[a.type]}),a.transient){null==g||g(a);break}let b=null!=a.id?e.message.parts.find(b=>a.type===b.type&&a.id===b.id):void 0;null!=b?b.data=a.data:e.message.parts.push(a),null==g||g(a),i()}}h.enqueue(a)})}}))})({stream:h,runUpdateMessageJob:async a=>{await a({state:i,write:()=>{}})},onError:d}).pipeThrough(new TransformStream({transform(a,b){b.enqueue(a)},async flush(){let a=i.message.id===(null==f?void 0:f.id);await c({isAborted:g,isContinuation:a,responseMessage:i.message,messages:[...a?b.slice(0,-1):b,i.message]})}}))}({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(a,b)=>{let c=null==d?void 0:d({part:a}),k=a.type;switch(k){case"text-start":b.enqueue({type:"text-start",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"text":b.enqueue({type:"text-delta",id:a.id,delta:a.text,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"text-end":b.enqueue({type:"text-end",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"reasoning-start":b.enqueue({type:"reasoning-start",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"reasoning":e&&b.enqueue({type:"reasoning-delta",id:a.id,delta:a.text,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"reasoning-end":b.enqueue({type:"reasoning-end",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"file":b.enqueue({type:"file",mediaType:a.file.mediaType,url:`data:${a.file.mediaType};base64,${a.file.base64}`});break;case"source":f&&"url"===a.sourceType&&b.enqueue({type:"source-url",sourceId:a.id,url:a.url,title:a.title,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}}),f&&"document"===a.sourceType&&b.enqueue({type:"source-document",sourceId:a.id,mediaType:a.mediaType,title:a.title,filename:a.filename,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"tool-input-start":b.enqueue({type:"tool-input-start",toolCallId:a.id,toolName:a.toolName,providerExecuted:a.providerExecuted});break;case"tool-input-delta":b.enqueue({type:"tool-input-delta",toolCallId:a.id,inputTextDelta:a.delta});break;case"tool-call":b.enqueue({type:"tool-input-available",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata});break;case"tool-result":b.enqueue({type:"tool-output-available",toolCallId:a.toolCallId,output:a.output,providerExecuted:a.providerExecuted});break;case"tool-error":b.enqueue({type:"tool-output-error",toolCallId:a.toolCallId,errorText:i(a.error),providerExecuted:a.providerExecuted});break;case"error":b.enqueue({type:"error",errorText:i(a.error)});break;case"start-step":b.enqueue({type:"start-step"});break;case"finish-step":b.enqueue({type:"finish-step"});break;case"start":g&&b.enqueue({type:"start",...null!=c?{messageMetadata:c}:{},...null!=j?{messageId:j}:{}});break;case"finish":h&&b.enqueue({type:"finish",...null!=c?{messageMetadata:c}:{}});break;case"abort":b.enqueue(a);break;case"tool-input-end":case"raw":break;default:throw Error(`Unknown chunk type: ${k}`)}null!=c&&"start"!==k&&"finish"!==k&&b.enqueue({type:"message-metadata",messageMetadata:c})}})),messageId:null!=j?j:null==b?void 0:b(),originalMessages:a,onFinish:c,onError:i}))}pipeUIMessageStreamToResponse(a,{originalMessages:b,generateMessageId:c,onFinish:d,messageMetadata:e,sendReasoning:f,sendSources:g,sendFinish:h,sendStart:i,onError:j,...k}={}){!function({response:a,status:b,statusText:c,headers:d,stream:e,consumeSseStream:f}){let g=e.pipeThrough(new dx);if(f){let[a,b]=g.tee();g=a,f({stream:b})}dw({response:a,status:b,statusText:c,headers:Object.fromEntries(dv(d,dy).entries()),stream:g.pipeThrough(new TextEncoderStream)})}({response:a,stream:this.toUIMessageStream({originalMessages:b,generateMessageId:c,onFinish:d,messageMetadata:e,sendReasoning:f,sendSources:g,sendFinish:h,sendStart:i,onError:j}),...k})}pipeTextStreamToResponse(a,b){!function({response:a,status:b,statusText:c,headers:d,textStream:e}){dw({response:a,status:b,statusText:c,headers:Object.fromEntries(dv(d,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:e.pipeThrough(new TextEncoderStream)})}({response:a,textStream:this.textStream,...b})}toUIMessageStreamResponse({originalMessages:a,generateMessageId:b,onFinish:c,messageMetadata:d,sendReasoning:e,sendSources:f,sendFinish:g,sendStart:h,onError:i,...j}={}){return function({status:a,statusText:b,headers:c,stream:d,consumeSseStream:e}){let f=d.pipeThrough(new dx);if(e){let[a,b]=f.tee();f=a,e({stream:b})}return new Response(f.pipeThrough(new TextEncoderStream),{status:a,statusText:b,headers:dv(c,dy)})}({stream:this.toUIMessageStream({originalMessages:a,generateMessageId:b,onFinish:c,messageMetadata:d,sendReasoning:e,sendSources:f,sendFinish:g,sendStart:h,onError:i}),...j})}toTextStreamResponse(a){return function({status:a,statusText:b,headers:c,textStream:d}){return new Response(d.pipeThrough(new TextEncoderStream),{status:null!=a?a:200,statusText:b,headers:dv(c,{"content-type":"text/plain; charset=utf-8"})})}({textStream:this.textStream,...a})}};a8({prefix:"aiobj",size:24}),a8({prefix:"aiobj",size:24}),((a,b)=>{for(var c in b)cg(a,c,{get:b[c],enumerable:!0})})({},{object:()=>dJ,text:()=>dI});var dI=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:a})=>({partial:a}),parseOutput:async({text:a})=>a}),dJ=({schema:a})=>{let b=bx(a);return{type:"object",responseFormat:{type:"json",schema:b.jsonSchema},async parsePartial({text:a}){let b=await dz(a);switch(b.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:b.value};default:{let a=b.state;throw Error(`Unsupported parse state: ${a}`)}}},async parseOutput({text:a},c){let d=await bo({text:a});if(!d.success)throw new cQ({message:"No object generated: could not parse the response.",cause:d.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});let e=await bm({value:d.value,schema:b});if(!e.success)throw new cQ({message:"No object generated: response did not match schema.",cause:e.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});return e.value}}},dK=(Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),bC.Ik({name:bC.Yj(),version:bC.Yj()}).passthrough()),dL=bC.Ik({_meta:bC.lq(bC.Ik({}).passthrough())}).passthrough(),dM=bC.Ik({method:bC.Yj(),params:bC.lq(dL)}),dN=bC.Ik({experimental:bC.lq(bC.Ik({}).passthrough()),logging:bC.lq(bC.Ik({}).passthrough()),prompts:bC.lq(bC.Ik({listChanged:bC.lq(bC.zM())}).passthrough()),resources:bC.lq(bC.Ik({subscribe:bC.lq(bC.zM()),listChanged:bC.lq(bC.zM())}).passthrough()),tools:bC.lq(bC.Ik({listChanged:bC.lq(bC.zM())}).passthrough())}).passthrough();dL.extend({protocolVersion:bC.Yj(),capabilities:dN,serverInfo:dK,instructions:bC.lq(bC.Yj())});var dO=dL.extend({nextCursor:bC.lq(bC.Yj())}),dP=bC.Ik({name:bC.Yj(),description:bC.lq(bC.Yj()),inputSchema:bC.Ik({type:bC.eu("object"),properties:bC.lq(bC.Ik({}).passthrough())}).passthrough()}).passthrough();dO.extend({tools:bC.YO(dP)});var dQ=bC.Ik({type:bC.eu("text"),text:bC.Yj()}).passthrough(),dR=bC.Ik({type:bC.eu("image"),data:bC.Yj().base64(),mimeType:bC.Yj()}).passthrough(),dS=bC.Ik({uri:bC.Yj(),mimeType:bC.lq(bC.Yj())}).passthrough(),dT=dS.extend({text:bC.Yj()}),dU=dS.extend({blob:bC.Yj().base64()}),dV=bC.Ik({type:bC.eu("resource"),resource:bC.KC([dT,dU])}).passthrough();dL.extend({content:bC.YO(bC.KC([dQ,dR,dV])),isError:bC.zM().default(!1).optional()}).or(dL.extend({toolResult:bC.L5()}));var dW=bC.Ik({jsonrpc:bC.eu("2.0"),id:bC.KC([bC.Yj(),bC.ai().int()])}).merge(dM).strict(),dX=bC.Ik({jsonrpc:bC.eu("2.0"),id:bC.KC([bC.Yj(),bC.ai().int()]),result:dL}).strict(),dY=bC.Ik({jsonrpc:bC.eu("2.0"),id:bC.KC([bC.Yj(),bC.ai().int()]),error:bC.Ik({code:bC.ai().int(),message:bC.Yj(),data:bC.lq(bC.L5())})}).strict(),dZ=bC.Ik({jsonrpc:bC.eu("2.0")}).merge(bC.Ik({method:bC.Yj(),params:bC.lq(dL)})).strict();bC.KC([dW,dZ,dX,dY]);let d$=(0,c(3695).ER)({apiKey:process.env.OPENROUTER_API_KEY});async function d_(a){let{messages:b}=await a.json();return(function({model:a,tools:b,toolChoice:c,system:d,prompt:e,messages:f,maxRetries:g,abortSignal:h,headers:i,stopWhen:j=function(a){return({steps:a})=>1===a.length}(0),experimental_output:k,experimental_telemetry:l,prepareStep:m,providerOptions:n,experimental_activeTools:o,activeTools:p=o,experimental_repairToolCall:q,experimental_transform:r,includeRawChunks:s=!1,onChunk:t,onError:u=({error:a})=>{console.error(a)},onFinish:v,onAbort:w,onStepFinish:x,_internal:{now:y=function(){var a,b;return null!=(b=null==(a=null==globalThis?void 0:globalThis.performance)?void 0:a.now())?b:Date.now()},generateId:z=dG,currentDate:A=()=>new Date}={},...B}){return new dH({model:c$(a),telemetry:l,headers:i,settings:B,maxRetries:g,abortSignal:h,system:d,prompt:e,messages:f,tools:b,toolChoice:c,transforms:cl(r),activeTools:p,repairToolCall:q,stopConditions:cl(j),output:k,providerOptions:n,prepareStep:m,includeRawChunks:s,onChunk:t,onError:u,onFinish:v,onAbort:w,onStepFinish:x,now:y,currentDate:A,generateId:z})})({model:d$("kimi/moonshot-v1-202412"),messages:b}).toUIMessageStreamResponse()}let d0=new L.AppRouteRouteModule({definition:{kind:M.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/gorkolas/Documents/www/cybertantra/apps/cybertantra/app/api/chat/route.ts",nextConfigOutput:"",userland:K}),{workAsyncStorage:d1,workUnitAsyncStorage:d2,serverHooks:d3}=d0;function d4(){return(0,N.patchFetch)({workAsyncStorage:d1,workUnitAsyncStorage:d2})}async function d5(a,b,c){var d;let e="/api/chat/route";"/index"===e&&(e="/");let f=await d0.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o}=f,p=(0,Q.normalizeAppPath)(e),q=!!(k.dynamicRoutes[p]||k.routes[o]);if(q&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[p];if(b&&!1===b.fallback&&!a)throw new Z.NoFallbackError}let r=null;!q||d0.isDev||j||(r="/index"===(r=o)?"/":r);let s=!0===d0.isDev||!q,t=q&&!s,u=a.method||"GET",v=(0,P.getTracer)(),w=v.getActiveScopeSpan(),x={params:h,prerenderManifest:k,renderOpts:{experimental:{dynamicIO:!!i.experimental.dynamicIO,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:s,incrementalCache:(0,O.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:t,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>d0.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},y=new R.NodeNextRequest(a),z=new R.NodeNextResponse(b),A=S.NextRequestAdapter.fromNodeNextRequest(y,(0,S.signalFromNodeResponse)(b));try{let d=async c=>d0.handle(A,x).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=v.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==T.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${u} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${u} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,O.getRequestMeta)(a,"minimalMode")&&m&&n&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=x.renderOpts.fetchMetrics;let h=x.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=x.renderOpts.collectedTags;if(!q)return await (0,V.I)(y,z,e,x.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,W.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[Y.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=Y.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,d=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=Y.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:$.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await d0.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,U.c)({isRevalidate:t,isOnDemandRevalidate:m})},l),b}},p=await d0.handleResponse({req:a,nextConfig:i,cacheKey:r,routeKind:M.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:o,waitUntil:c.waitUntil});if(!q)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==$.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,O.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,W.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,O.getRequestMeta)(a,"minimalMode")&&q||s.delete(Y.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,X.getCacheControlHeader)(p.cacheControl)),await (0,V.I)(y,z,new Response(p.value.body,{headers:s,status:p.value.status||200})),null};w?await f(w):await v.withPropagatedContext(a.headers,()=>v.trace(T.BaseServerSpan.handleRequest,{spanName:`${u} ${a.url}`,kind:P.SpanKind.SERVER,attributes:{"http.method":u,"http.target":a.url}},f))}catch(b){if(w||b instanceof Z.NoFallbackError||await d0.onRequestError(a,b,{routerKind:"App Router",routePath:p,routeType:"route",revalidateReason:(0,U.c)({isRevalidate:t,isOnDemandRevalidate:m})}),q)throw b;return await (0,V.I)(y,z,new Response(null,{status:500})),null}}},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6231:()=>{},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},8079:()=>{},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[471,698],()=>b(b.s=2785));module.exports=c})();